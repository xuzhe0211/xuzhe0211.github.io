(window.webpackJsonp=window.webpackJsonp||[]).push([[675],{2700:function(a,t,s){"use strict";s.r(t);var e=s(46),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[a._v("#")]),a._v(" 背景")]),a._v(" "),s("p",[a._v("随着Babel、TypeScript、VueLoader，Terser等编译、转义技术的大规模使用，Webpack的编译时间正在不断膨胀。为了优化编译速度，社区主要有两种方案")]),a._v(" "),s("ul",[s("li",[a._v("通过把loader的处理结果缓存到本地磁盘，来加速二次编译")]),a._v(" "),s("li",[a._v("通过预编译dll让webpack跳过一些模块的编译，来加速编译")])]),a._v(" "),s("p",[a._v("这些方案在一定程度上解决了编译速度慢的问题，但随之而来的是成堆的配置，严重影响了webpack的使用体验。")]),a._v(" "),s("p",[a._v("与此同时，社区出现了一些新兴的编译技术，比如Snowpack，它使用浏览器原生的ES Module实现了O(1)时间的编译，对于“苦Webpack久已”的那些人来说简直不要太有吸引力。")]),a._v(" "),s("p",[a._v("但是这对Webpack来说是一种挑战，面对可能会被蚕食的用户市场，Webpack5的内置缓存方案终于出来了。")]),a._v(" "),s("h2",{attrs:{id:"插件简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#插件简介"}},[a._v("#")]),a._v(" 插件简介")]),a._v(" "),s("p",[s("span",{staticStyle:{color:"red"}},[a._v("HardSourceWebpackPlugin是webpack插件，用于为模块提供中间缓存")]),a._v("。为了查看结果，您需要使用此插件运行两次")]),a._v(" "),s("p",[a._v("webpack:第一次构建将花费正常时间。第二个版本将明显更快。适用于在开发模式developmentent和生产模式production下。速度提升效果是原来的好几倍")]),a._v(" "),s("h3",{attrs:{id:"使用hard-source-wbepack-plugin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用hard-source-wbepack-plugin"}},[a._v("#")]),a._v(" 使用hard-source-wbepack-plugin")]),a._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[a._v("npm install "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("save"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("dev hard"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("source"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("webpack"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("plugin\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 或")]),a._v("\nyarn add "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("dev hard"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("source"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("webpack"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("plugin\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" hardSourceWebpackPlugin "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'hard-source-webpack-plugin'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" isDev "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[a._v("NODE_ENV")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("===")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'developmentent'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("export "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[a._v("configureWebpack")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[a._v("wbepackConfig")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=>")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("var")]),a._v(" plugins "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        plugins"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("push")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("hardSourceWebpackPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        webpackConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("plugins "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("...")]),a._v("webpackConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("plugins"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("...")]),a._v("plugins"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("h2",{attrs:{id:"cache-loader简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cache-loader简介"}},[a._v("#")]),a._v(" cache-loader简介")]),a._v(" "),s("p",[s("span",{staticStyle:{color:"red"}},[a._v("缓存加载器的编译的结果，避免重新编译")])]),a._v(" "),s("h3",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[a._v("#")]),a._v(" 使用")]),a._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[a._v("npm install "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),a._v("save"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("dev cache"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("loader\n\nmodule"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("exports "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    module"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        rules"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                test"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[a._v("\\.js$")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[a._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                use"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'cache-loader'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'babel-loader'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                include"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'src'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),s("h2",{attrs:{id:"webpack5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webpack5"}},[a._v("#")]),a._v(" webpack5")]),a._v(" "),s("h3",{attrs:{id:"长效缓存和编译缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#长效缓存和编译缓存"}},[a._v("#")]),a._v(" 长效缓存和编译缓存")]),a._v(" "),s("p",[a._v("长效缓存是浏览器层面的缓存，Webpack通过optimization的splitChunks和runtimeChunk的配置，让编译输出的文件具有稳定的hash名称，从而让浏览器能长期有效、安全的复用缓存，达到加速页面加载的效果。")]),a._v(" "),s("p",[a._v("编译缓存是编译时的缓存，Webpack通过在首次编译后把结果缓存起来，在后续编译时复用缓存，从而达到加速编译的效果。")]),a._v(" "),s("p",[a._v("webpack5的内置缓存以及本文讨论的，都是编译缓存")]),a._v(" "),s("h3",{attrs:{id:"webpack4的缓存方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webpack4的缓存方案"}},[a._v("#")]),a._v(" webpack4的缓存方案")]),a._v(" "),s("p",[a._v("在使用webpack4以及之前的版本，我们都会注意到这样的现象")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("代码热更新很快\nnpm run start慢\nnpm run build慢\n")])])]),s("p",[a._v("这种现象的本质是："),s("span",{staticStyle:{color:"red"}},[a._v("webpack4在运行时是有缓存的，只不过缓存只存在在内存中。所以一单webpack的运行程序关闭，这些缓存就丢失了。这就导致我们npm run start/build 的时候根本无缓存可用")])]),a._v(" "),s("p",[s("span",{staticStyle:{color:"blue"}},[a._v("所以，解决问题的办法就是把这些webpack编译过程中产生的缓存持久化到本地磁盘、数据库或者云端。这里涉及到两点："),s("strong",[a._v("要持久化什么，持久化到哪里")])])]),a._v(" "),s("p",[a._v("webpack本身已经有一套缓存方案，只是不够完善，"),s("strong",[a._v("不支持持久化")]),a._v("。站在现在的角度来看，我们应该去完善webpack核心代码，补充上持久化缓存的作用，使用一套缓存方案解决所有问题，这是显而易见的")]),a._v(" "),s("p",[s("span",{staticStyle:{color:"red"}},[a._v('然而，当时社区好像没搞清楚"要持久化什么"这个问题，他们没有在webpack核心代码上乏力，而是选择了外部解决。于是出现了cache-loader、dll等技术，虽然一定程度上解决了问题，但却引入了过多的复杂性')])]),a._v(" "),s("h3",{attrs:{id:"webpack的缓存方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#webpack的缓存方案"}},[a._v("#")]),a._v(" webpack的缓存方案")]),a._v(" "),s("p",[a._v('实际上, "要持久化什么"这个问题从一开始就是显而易见的：'),s("span",{staticStyle:{color:"blue"}},[a._v("是webpack运行时存在于内存中的那些缓存，不是loader的产物，更不是dll")]),a._v(".因此，webpack5提供了一套持久化抽象，并提供了几个实现：")]),a._v(" "),s("ul",[s("li",[s("span",{staticStyle:{color:"blue"}},[a._v("IdleFileCachePlugin: 持久化到本地硬盘")])]),a._v(" "),s("li",[s("span",{staticStyle:{color:"blue"}},[a._v("MemoreCachePlugin:持久化到内存")])])]),a._v(" "),s("p",[s("span",{staticStyle:{color:"blue"}},[a._v("根据webpack运行环境的不同，在dev开发时依旧使用MemoryCachePlugin，而在build时使用IdleFileCachePlugin")])]),a._v(" "),s("p",[a._v("webpack5直接从内部核心代码的层面，统一了持久化缓存的方案，有效降低了缓存配置的复杂性。除此之外，由于所有被webpack处理的模块都会被缓存，我们npm run start/build的二次编译速度远超cache-loader，同时dll也可以退出舞台了。")]),a._v(" "),s("p",[s("span",{staticStyle:{color:"red"}},[s("strong",[a._v("webpack4时之所以要有dll，是因为cache-loader并能覆盖所有的模块，只能对个别别被loader处理的模块进行缓存。而那些通用库是没法被cache-loader处理的，所以只能通过dll的方式来预编译")])])]),a._v(" "),s("p",[a._v("实际上webpack5的内置缓存方案无论从性能还是安全上都要好于cache-loader:")]),a._v(" "),s("ul",[s("li",[s("span",{staticStyle:{color:"red"}},[a._v("性能上:由于被webpack处理的模块都会缓存，缓存的覆盖了要高的多")])]),a._v(" "),s("li",[s("span",{staticStyle:{color:"red"}},[a._v("安全上:由于cache-loader使用了基于mtime的缓存验证机制，导致在CI环境中缓存经常会失效，但是webpack5采用了基于文本内容的etag缓存验证机制，解决了这个问题。具体使用"),s("a",{attrs:{href:"https://webpack.docschina.org/configuration/cache/",target:"_blank",rel:"noopener noreferrer"}},[a._v("查看官网"),s("OutboundLink")],1)])])]),a._v(" "),s("h2",{attrs:{id:"资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[a._v("#")]),a._v(" 资料")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://blog.csdn.net/weixin_42471170/article/details/113307504",target:"_blank",rel:"noopener noreferrer"}},[a._v("webpack-HardSourceWebpackPlugin和cache-loader插件优化开发模式的构建速度"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("a",{attrs:{href:"https://www.jianshu.com/p/cef540b31c38",target:"_blank",rel:"noopener noreferrer"}},[a._v("webpack优化策略---比较重要"),s("OutboundLink")],1)]),a._v(" "),s("p",[s("a",{attrs:{href:"https://webpack.docschina.org/configuration/cache/",target:"_blank",rel:"noopener noreferrer"}},[a._v("webpack5官方文档--cache"),s("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=r.exports}}]);