(window.webpackJsonp=window.webpackJsonp||[]).push([[228],{1331:function(t,s){t.exports="data:image/png;base64,UklGRoghAABXRUJQVlA4IHwhAABQwgCdASqMAsEBPpFInUulpCMhobT6KLASCWdu/FJQBGuvGWNAP7bALrGoLwB/R9nt+P/c/Tbt/g6iBd32SP1Afo/2APMB6Bv6h6Cv6D6If+X/cr3K/2L1AP6h/dPW19Rz0BPLw9lL/D7/x0u/SX+2fz7uQ/yv938afF/7r9o/XNxx9WupN8t+3/6X1q/v/+78Ffjz/geoF66/1HfX9rxt/+99AX2M+0/8r+9+O/9Cepn2W/6vuAfz7+1ekn/V8KD1z2B/6X/of+/7Nn+B/6/9z+YXuS+t/YR/XbrffvD7Lo1JxRotILOHRJQnILYuK4o0WkFnDokoTkFsXFcUaLSCzh0SUJyC2LiuKNFftyLqkpKSkpKSkpKSkpKSkpKSkpFmraxazfTkFsXFcUM5hV00PA0JpBzhZq2Pqo+4UkIqBrt55SXnQ+nShOQWxcVxRotH8Befm+9CzAC7IIC9n+LN3l7X33HVcTmis/45Zm3yogdz2Q2FY51GxZ27+c/PoOCNVxfwY10AXC4UUNAa660gLOtfxb8Ou00GAPlWnmTi4M5hZvpyC2LiuKNFhzrG7GV5sa1aTXKEt6i+aGiuuLpNceOrU3MBPwzsaGmic5Q7qOcVxRotILOHQ3bCuKDeUuGmmmHXGdKpghObIePm907svan2Lfuy79m2s4oypwkoTkFsXFcUaLQvYjfSWfgDs+Pj4+PjpKL9lzrqQwRGyInBzcXLBJBZw6JKE5BbF1N63SMJeW6RhLTlT66qw1x0Zmc+UR305BbFxXFGi0gs4dElCcgnHIv3GZAti4rijRaQWcOiShOPh4B+XWl1fX19fX19fX19fX19fX0CMPUSUJyC2LiuKNFhj7I/q+HEFTVOOhAaWoZojafJghdqu4kQrwpdTmTAe0ucInqPmmeyCBx01bvhi2wcxmuYjvlF80QtMRGKRbFxXFGi0gs4YxZumwLzNfUxmcUfJrqTW8ktGqyxQgjtAVBi8mD8jyLwsIe+VgkLXWDlJLeF1mxtILOHRJQnILYX6iYqWdT/re4GIyxZQgU3pFshXdreqjYrF7Ofd09A16Y5WF+t8JZw6JKE5BbFmEAs3bHJl4o78v/06zotox/DxWu7Zbt/J0xz+jr4gF+i4HkFdBxdlNdZxP3OxhWZxkWIR6joGsQt+iyIL+LndiVLs9nmizVidFz/zmU9cgti4rijRaQWUO6jmFsOCLfr547TtF0MWOuFz/gAD1iBdzuRJQnILYuK4o0V7bmx2qVppaBpaR0R7Qe3zhCe8OxUmaqyyFYcOUnEXG3CBXFGi0gs4dElCdEK5ofdNeHKng62KAxAheNJQnILYuK4o0WkFnDokoThjbWLiuKNFpBZw6JKE5BOQV6QipKAhhw5TS0A3RqlaaSzTa2Fm+nILYuK4o0PbvaBDkPHzKckZ0gJ+3lDMI+bfagLIVpyFplDVhgiJpivYgUA6HMPr+mYe9DsFSCzhzKmhFbaXiuGhEv1OzhSgblnBIAYruEchhw5SS3Vxx8guVyXLxoj2gr4/H1StMu8SQ8BnoR8n/pyChHRBuhHwWyoFFgSJVo3Hw9AC94nuk2LPDwlf5OXxfK6Xp/SVx8jKk6EKQUY+f7vVX9iXJOzFLOHMzZgnDKiENxUKJo0P/C9ckt6Zi+IWmOMu8eqUOyk6Lpso2Ltq4WB4RQVbZTiRRyUL5bxaST05PbR55+WLCrixAXV7ejLr0+FqjATwu0eTeHOyKvd4ZQySIAEJLkkCoGBaHntN2SsS9o1vnu9pYHa23SDGLXJx5jOrJTGxSGx7u1pjx17SUJeeyWLC2LeSXnhHBc8VMgii2GUKFsfAXPHZ1dKqBqjZmCx/tH2Rh+kIWOfo1JT3j/JIJ3a4VOtLaLY3wT2dnZ2RNbio2RD9n/kyLDcHKI5w4R6wQ7MQE74f/4jF5q8BSKhOQXEjbQhtq4gQhXNELTJg4rtltkVQG6n2n10sN+f9sMczHAsLgCRl6DIHIFvgUcD1gfJkOczdXvxtJQnILYuK4o0WkFnDokoS0vJAU2VUArzOBKBwzxi4nRJQnILYuK4o0WkFnDokoTkJC7OPgAA/v9W0AAAAAAB0/Ps9Y/wwOepCfHxT+EDAZCeMi1HKtbdqoMZx0LkpqFkFkFkFkFkFkFkFkFkFkFkFkFkFkFkFg3n6/D/g1pa09yDwy6lo5C2Y+IbNJI93FV1iAkiiPw1Hl0MddKEEV3mec9nF839xPWiPbjyGKgk/OR4Cwh05xkJjtXuZG5TNlmxsQYkfLl6cqeD0u5mFYTegbcy91O+8LMp5pzAh+jGU2f9pHNoh0927xcCqpDB+AIiFh32DgdLpwI0wUIwAvgY9YKkE9XEYBT+Xvkh8rEiotNLAFAlQOUS8QA+v73tbjZPOWRlDG7q/5Q2Yj6D0goB8DcNsEkx4adpTSk3jD9ZGteGAoynIIHBJ/nXNnJrYo4L8ZBiCGBy2ahOxp0q0FgUAalx9w4kSMqrFlW0irfJe4x9JhDpzem+YcYiakxGrtmuFqQ9kbJRAUqCkngUqn4JEziECWu163ZwzhZSGqR+sWhtrDpJWGKeqTEjZrOj5doQr/uMBrfhJAig3XtnWJv6jip9nCr+hIXaoTvP0tg4jEzmiJOZek9Nz0Ackvo4jxwpegMj7Uag8DyKiJJj1h2wPu2gROog8LSFTLz3/j2wIjaNB5HxvM83c1TfzAqjZjdRjTuwe6GqdVlSRzB/K4M4OrMSsAjteFbHZ01L0qlBxU9ZuRTWoHmhUFdFR9ff4W9dcYo9Y4sDoOnuMli33VTLVQGhjSOWPCS1GI+2RJR87AKo0cAueGweFFzbLOaKRaGGsJzuygY8Ri4HuLRDDwpmWzDiBkKKN8X60LoGAmumtkA9DrUf1b9TazDGJ1tTyPCMcgKvSwo1LTies6dcCEC4Df9jd4GWXnO+8JEW7AQeZvrD/kzByunwo6DET17s2DlTKQTuwaPgeqSfAFF5wpYsXoGFPiDtfROJ2gLz7BtAuhRK/r/kfFvaHB/PMURzvgbR0XwdlEmqtk48+hiLMqIghteakx0qebQ7x1DCiZ0UzrliGKgnkFuvuCG/MFwhnnMrVHp8ch1z3CppWNHwKFCgyx7zffg1x11h0Zo6dOFn0T3hkncdcxNn0+8y/XYr6CAyEONEodBXPdlijQkHuvAvWmTqFJix7CRaPPHa4yqSO9xShKGptOmA+LEg++2IEyumwsn0gDPvKo06Z5sj9wf7GGHh91qYmYWRi5BjCNk1OhRTIkcAJuDLlfIA2XfDo+MWrC31CtzyUKJn7kEo7x7xmDllrs0gSc7IXsfgZDcU63mPD0sVEcyCPIEyMUq5/AQEarH7nU621NIWrCObsLj/GgFTnTdkFMCxAyFFD8x+okGfm29xjuXOSiD+2TXuxalKjxfzYv65raM6meaQ1KxYMOgm7dDpf51uY9ouk4YOR18zKaVTRXK6YMcPy8Sjc6r6LqRS125VqveBvizX/ICjAZPihpwEOyKaKFmAz3hTcVR0g8JvXCrWG9FcvEklprirElw1sp3p3rHnbJlKXPW/Rc8km+meyOXY7LuLsJRlnTKmGn3NuusLXTk42C/xaTkpIFdTAp/PdfLsNCG0mciEkc4Sbzt+LG3xss57E/IwOJVFA7fLic+BUnfStzqTOM4pSwicpP1UJjf0OaY+i6290agkyUPITFCU4M32pNyYR7J5LzAbAy+oHfkE9IVABfJmt73mpkrTS8jJk49a301b52znbZVVJCVXo+7BQRMlgi7aAVBFvoAdArgEGbTXdmAB5sOijlVV6wwaPm6KlnSJcvLb2UpAF7vloeOXOtScSNzE8OHNh2U+QeSUGzrCGeEre6C4+XSwdRCeV9SghMM+GSRPSmmObzzYgBKFrIxlRAjCsE7Xt6z3fYaB2bao9fw3HJcsP+E8qH0OME0TCJEpaQRPC8ZfWPGhNw3soA5uThmaID/Qw+SzdINaHhrPDjoiDWtVe2jhexWrPHkdbjpALfQ4NUxe4aXBvrJ1AsIADw07FC2cwJhn7sRYuZEc1csckHLr9RNG268QOi3gVKRQ5faEjSDXt9V0GjRKHneSiB4gyzqrwbgojdG2XYAk3yiS2jSOyZi+LD0iP/M2zJS8LtTRCRqyOZANLp7TgQ5tAAFHB5uHAUdBdtTnZ05apKubWD3axqYC8pFtLZSAUhIcOyw9FTprwzvWIWdlzOo6wvDQV7LCIbWqKL/YZz63Q9gz9bbUUgy1e7Yyo3QBox0x3+L6qEmWNTkc1/IxOffmhTv7M3LV1NKBORRkX9Zfyc8MOl0aGKHqAFrpIt/EFVC/Ct8oiJP9t3c9jN5zh3w0UmGfFV2ErEWIgOY0Z1qYax75dLsL1QAATDd3Q/PLRfZcLQGofguI9LIwHciQ7dFJ4WJmW4WUh/0Ar2bkdIdD4EcQB3GpP+/Yk7NLtuGyYy4QybzEAAAqT6Vdk3JkAbdQAABQewu5UcIsk+1oTW9vJM6D/wAv6kYAOJKlP4bttRt/4HAsJeX//JyMRvTcJVH9Cq7G78qp9pUhoqHw7HD5lw9nHRFcyWgATNrKNrnw8HXZkMUBorcxZ4XL5hYVitybcS83nRG4VGuJACMqt7ro+bxFJSm5gjKUnQ1//P9gAUMz81ih/AAusSFrci63obQg9bOtsCAOHxdPZC/8d+ncO2XzHA6c/2XtOL9ht1659rLacST/Ob8aQdcOEpxyHd6PhVempoeaez1L9tsx5ryPpJ0Rjub0R0zjJVcSCo8NPiZwIrmkTxeXVSSYJQC65Zjm94CEQLVX7I6bBzhS0rxf9LywjqmC512Pwqlnrki6BaHx/KtATQLCW8lVziU2i+B3kbubFZPmS9q2uPg+9qes7nj+RvzA+Nam+xAckWSJu9E+asCV2j+Q1Ia3gFvX84sQtxmcySoXyZrfRDOjy6cgbl3auyITVsDmQJFmrXdcgPnP9A5raAJnOmTW3y/+h90sN9qCbED6/OU5/mWW15CBJyqrwg4/YEi5tY5ZO+bOjUgdo35TXvR8pIE8XhwjKnlotXDswTj4rZWFKjVMi/pT6w3OjqxgV76Fs4n1hP/yZ9VR0KX7hLAcpmOOmwWfeUKnFEGMUd37X9d7A4XsSnJM6cb6zuRugCMZ+KWp7vtW6WW+0XpWtb1Vom7HhEWMW8E2zyI0Y+EUwLL1aO+G0LlMen5JVle0wzqMf7X6qHUnzqRF/n1Ca+JuE0vPVWMWRIefc66KuZ+sirPWagc6NQY+ddkCuFoj11IM9jSIA68Z58/fH0Do/zWbq9neapBHaeRKTWvAPdjTyQUDg7LgcvDjsQe8Pn5DoJlJYZ8kP/FeDLdECaqx94TBQ0xbsAEJYXjZecu7Vq06wETMRryfqriGZXrbj5QS1nw/kW3bHJBhbFaD77Cnuh/yJarmg9RHCi/Hhb+eBEtoK3X+vaGMCeWiOnLbsQQmW2uSNYeObNi3qyEsCd5UXu15WLo/nSnRx5vbAqiW2rj/VHVFfBI+DhI5qONUpIn83Ja6lRHFAFstQckjm2dLG1gwlHw8afn7kR7WgsK/aFNKbidr+dL/hB2wJXdYQtd9BURZl/jV3ejLoH/SdZwOFn3qmfbg0pyvar4xXaOAD00TqtKJT44XEEiESeC/N1aFLyqDFe0YxPATfnSBFPDRoVe/OaAmVdqAM/RQNoIVkPrp2iVz6bijt4QLqh7aGm7bbtfhcTqynsT4o3G1jtAZ95gJufdGNDN88eyTNXpUZLvfnOtu582fP8vhglFFsqG8gR+IkrUBPPwEWMX0gvEagG9NWW64UXS+qgX8WrjWsBr4n1JX0QBj6uYioFMYvvvmP1kAjf45+e9UjeFrfFpL3h+TBupGgy5JUsjMhjgPooDg/Z8dypoYmXWvKZLRNkiKkfQjgDXLX7SYHAoGxovl/bEZ8PjFRmUjUUCtv+7S3ndSHyyFDA9RyeacqP6czQBNyNCtrEK12fKbBxgof6EBSL9UmCuSoIBjdY1yqiQ+miwK8MWykiDHiFygXp8/JOeGgPZHRsTmuRB+KGirumAZpv3VzT+/K+KR/xf2BJFHQZDOhCj7K9Xvj1XbNO5KbGHTrNKSIVkY6Bphq8ymsNVpnA2WHPPSpBdPKlxQCCjRw5g3GRx5JPetzfuYQVTpCSMD+IbZkY3ZALd0RAXNph1YAygg76qYv/WNiF1SB3OBeIN440SKphrK7pP96ptEQiTJPUm6iMtwN4QTPnd4a1dXC4qg+IaVRQc78JC3+6iA1xzjvr7b+WNmKLm1AD4uSMTwb6MP7mGHv8/J2S2ZfCHiwqT1FR/n0wZ4PGsX+8IrP5VdoeAW3NEwpyVIwzfQ9/3AAvqTaJR83rigxfYAsKx10yhn8NkJAw9tl49Al1/3139JX3C2M4lsMguNshWeU+IJMqZh8V4HeXS25K6jiHkaaG9EI/R5GMkP+QYASTwv7r1C1Vy40QNLpiRAd0yv3MXO5kUQdx7G4l+iecjmQaOLSx0QVX9wv8U12SQAEguEj48r/q/Ca0FsCY8irgD7hNhw4LY6sb+jvDBbsMi/83+/KFn9GhvHDfvhb6NufIfcF75s7bqho20qJ3BQaj7vWLGxUk6ocdwyVgdqerc7OO8Luy3ItP51CgFQ/meAqJvriGNrPH6LXokSWwAvPpZHMMf13KCvKXRA7rehshqqf6L1OMrlmmxOb+80joMRkXdLC1EXmm5AcHGw7VvN7qBM7+lkz0mBMT3amVre0vDSwhjDxVgq/Cz6X4OYQk7R/gQBVz4xjK6B2elxDdO00kZYwxzKDQfwMYXVFh56jekwSnLt0dRFhvy/QOFt9Lc9w11XP2wSmlwfeMESuijDGrlgfBlX87nFXvA8zeB3Egwyk+uWAbCXDPVT5uQbrsA4pVVJk2g5yZgVUD4581G+EmQ3ByB2uJoldNzmHfqnZWn4Alej4GnB+91o2KZuCtE6JJPRfFMpe7pgQb+kPywBMHA49iHr4ixugfL5KucT1PVwUhIaOeQBEyKCqYaGGah3gYpYIBDR2TToPNPVEjuehU9dvzwyviCeXoYvXxPMRFhkhUuRzZDbIRuQ+Ss2wYVIrggAV+F2i5OjVkf+nJ+kDOCHyPuCcyfSkbu5zbQ+OO8l/MfSUkjTcFX7W9xCq9oT9jpHXjesxIhQF6wwh+/2KDfJ0C2CMJrlGWQjXxk2xsTn9Y5SuPUz+lWGK7WzhMtwXu0HSo/58Os46L9r+J5pFqrbx23dx4vpRBErDboW7ZH1jE0bonME3nxe15cgAAAX6wKAAAAAPDBAB355K+6owba3Clx1++aka/FCariDLGoE0pp++baQfY+vr6+vr6+wWr5sryri0Uf/+cPoIdFt4Cfr50ZK5uqeaqwoauW7QFwK4bg+vsFXI83sRngE+4EEhTS1u27DAUAj2K4PiejnoLZ/i7fuwciGNOSecQbFG2ebn4rGTpvWNw0kH58Lb8QPfTmXjCxk7otkrpW3Va6k929sU+nTOPaqhl7Ac05pptIRYvzDLCz7uECgGHfPWDQJXPsGu+0/HZZfVcUn/J5a7M3RY9ORgQjjvCKNUadxKf4Fy4Qh3oU4v1wVowyTBjbsY23ZlTVw3+3mdoOxbP7czGE/lO9WTpX7R162apNfdOC4WdPmGAN7OhviRcauqNHxDh7u3z8W3qnEa6liW1r4RIWokOjdqA85/F1ViaK5w8YqKgRStnfbP/2FGv/OhivjfiRfLd9jwAoY7P8zbvpXOFmW1JXgAENVcbSqizzHLio5Rblcd8bTkYRtZXxrXNqjHw27oN251rtXjp0F2PLQl7VyvjVZtaOwymBTM79b9GjHuo0/+CRWM5Nm052NVw+PUs3q5TUz6DlV9aA1PD/xxBrOVGnpwPXb3QHqCdwOufvf4Kb6pIrbCyZnhmIEREygf0wgq+rRDJKjXgJCqyAv+ceHT58B1De2OZFqbZIfQz8glg1VHpBfgNokl9kSn1nhsVAP+0y6XgdDxV0czx84Vex7BIYoBnh4OwmCJKllbFgtpPjzT24J6+fsvxOK8b9EWQWFl55HojoNTfBOJnpvmsA1AkmYt42rC6tWPfATIipexBMJvRdU6QRj524kqPvghythXShAZji9VXGvcqyt2J4n2MJnObD9OlbevmfKT1TDfAyiGeRDoITnEXhJO+n+TSoZ0/5i9rGYqXIls1tZyIqoltaQn6w48w79LciSV7U1vz5iP/+ugNMdmLyhonN7cyjqOfP6XKU/qBVXUGwE/YcOoFKZwpnyIcS/SodO26Mw52iYOtXKDy4sHk43Ub6pDkZstPDDGfUjB4vqawJ8p72hZXtWRdRuJxX4pyfavF5vMfeASdQOY7oqBLca3mgoEh+Tbxza4/Ls6I3lrA6OAWHTgTmO6ZX6W13cszYVe6ScEssyfl+7wkqgdmctY0Bb8lzA6e6q0tpA/IUDYD3ZqR3olxAE+j2oOGSUSIIERNMIFCcSTMb4mozzIJuBHxQwD7Ovlt0GypXbdlW6dYVak2FumEQ+uKL087jSAG27s8Hm12+vXy0q/kLPmLlgHYdJqYNYzbKzKPVNLCqqE1GNVaUa+fNQEPjqpRJwDAZ0BdOnAtSjOnGTYHo0P4ZixceMYesck6sS0JouLdKCwgT1jUyMHWzukfm2H7/gjxEqF4QgzJc+NRCzeKIMjvPdaUM25fq50KXhfcU2MnfxzK0iwD+1LpG55LNikKB/Ar6ZNlV/6vmMqec+ChPk9aJ/IMuqNkwu5rBiDG4DG/J0j4OXBrK2i96fUBGvqaK9M5A1ywwJvkvxPPyT3uU/l91qqbf9a+cY3SBFBnR2UNbK7sTytpyqueYvQmJAm8OeHVl7Q6ZXTE0SL2rt5JZMj44wHFAZywKRo95vFwDY4B9syXdBPCsQsGKVzG9I8QisSRXAL2ntSHNYAgU4Enqo6WjtHpu61doqcSXHVtstSyVVDXsARbQt1bQ2L6oA29gejIfcw3Ml/+Q909TAk/S8QJv4gLUMvodnD6Lw+ayBIgDFS5SLunvnQ8Cp0qqgc0DiUvKUtHxgQgJOg11eJ3bC4MrAw6/3GnWnQofYo9dCU1PlKN68khQR0zCCCc8X77nYvlDrlxOze+vp73wqOQYCmP9s5E+J8paCESr87uUhWxqukbeclS3YqxXpZrwGHGI7SqKIHSOjc65e2o1EPaP/faGjG8S/jFruD1877oNReQqhvt2PmWN+kNOs3s4JVLCaEdg1FuIAl9P1Xr+EZqssW9DucvCPJaKT/OPDclNTRpwXaVWfcrUmz4jM+4ULTQ+6p6N+4islXxzkLjV8sS9k58j6HA73s9hYjOtPVIqbAg4FNTitesxh0HtQGaoNIKpsAC0rlfFhthCROAsEn8X2O0VXViRfYo1pVf0VnF93JCPXWBNidC5QcHMB2qfZmumh1bKs+2JaQscAaRpHQmbGDPaMMb3qPX28+Wc5/FI85G3Y0N2oWrO8Jc5yozwSMwaHKLwJdmOS3u70MFDX8Cj7q/w+wk6tdBp7z9Iejykb3T6HUbjU8WL3xFq1D9Fsfl5MTfQje8y6esgFiz3JIEJTjfAFB6pG7q4G5l5Vfv79MPiC/wZTXsf9Ksk38y/YoOY73xmlqAgNt9U/fLjzrNU0D6a2Pub5y9ZM/8YNS6r4vsdUJJINPckdKjvotPhQxIc/9yUM1ZI8FF9pDLtiNy9RbyN2Hs353tUKcJBr4O3o8MjFgg6xxtElcs/RRUJm6SA1wSzkMfUC6y9wOgUy0c4AEgboTXicq5g69KFsVrRPnLFEVBStvKtcKNwn3R/azMQ1Ooe9MDQFxOmBpCaB7TqgSllR6KrEfS92V+PLNz7H00cCsHwUJ5JhcHtSjLG1ZG4eUwt1sdFcEt6CKSwmR322EGLIFvThBTUvhxC4GLnoXzK1ix90U9RaTqbbf7SecnGPJ7BIDOI32JEVNBBqfvBYZXEOobLNA+RPCiSFSwVasOEgdSt/phkzMVv8aJBmW2j8jJaSlA/YS5RJTKw+o3so7VePMQ3qq5OhEuR1HD+UBDm3L842DBKFzPKAGUgVpVyfLXtf451/MUVZVom7g+49sNzP6iHqznbZcj4HwR5ML75IT6ofuBBMMo470P1TL4BZgyxtm4cndQmoAG13e4SVdiWLQ3wH0fq6vIUWarcDvUf+aOYwaIwjerrZ4iPYnHgIJQ89d8vWf8gtI4rNDhs0+pV6OhqrRazBA5Xb7sGfYOvZpsaXXH6aP+V77LvA2AS8AJWgDN4Bugb6EYMsZdU7AsgpsJAj/PM6YhQNxLdN+8wXqVFmNT6gA5Yv678ABrOA1P5LyU9xXQqlfnxnqxKBZH1hlTkKCmwHoCI2kyLAD6HXGVc1jZl6t7FoVV3WZqxuvVlwnCNBdcq6KBzs3OE3wLvbEClrdwcBwhUEheLkZ2H1dAIGcUkxkrSg03jN9YuN59FRJGyJPop3cokkvEAC2UXJIMpkzCDgh574rKT87FZ+p+NFtc7nbj+iMMHvn2oJP1XkqSecbPGon8p+nviCAa9qDZqmOlqMH8hiPirrqhwJeC5mEM17f1YV7Qhnb5BX24YTuNJMZFR9MU+OLrK3L/f9Na46A9nqwEHnier0ZxXnTDM6lPUefSF54UVIJFn2S0HQwGJ4JBQRB3Z1NXMhAMWn73I7PVjqO0bxRf2J/AJw09bYoWlIy0AAAAHiDbW7mE2QtjH5GiKRsIPpkxutlqk+Xgo+01ZIbGsolDtKVtviP9Sq1eDbqybgRpkqh3Ztrzjb0wzeo7jPAzKI4X2ZEQOy4K9ZDdumx3pJh1e4LGsxYK4oxgLeQDMWZ9IXynhsA6s/HchimEqhwxLnort0Jkzd4odDO5dAd4RAGZXVcZ/cPiog3lWjzG2EwsRyy+6WsqEX35/x6qY2UDericyeli0eewUcQw7Nu59FES5Ny7VfgOjTFL7KRIK/FGCuP3SfjkU/F2WriY+BRD8HpaJzjXwFRxxt+vUuobav3WbLdMwtbHeRxjfmwVKgCA0TuXAeA9Kh2CZLiLkrJ6ey2DJFnHxCf3R/6aXC2JEqRjxMlNozvzFY6JmyLAzRy6+2gdfNcbcgzhZxN+kaW8yT/jZiscxR/3Ksh1gq7+8BqjfqHb/7OyH0FEQ8g4XYUcHvboaOfgyRGJRtyFJFnBvqI8FRJCc6WpL9jvtd1aTI/t28cazj7dghmQ715Lw5j6bSi9BxF/1YJmzoAALByUCtHEdkIukY5p2LqXwQfaUcJOhKFthH9QTKoeFJvlQe06YSh4rLsOZqZL8tJtTgCQ8xHOhAomITzZYy1AQesDoX0FE6Fp9qMUwuYI1oour8NU9ydTZTW6GlcM/tbjoXhUEHDQnyzTpIYoecO1R6rfxWijQb/DUSB0NkSHW2UAAAAAAA"},1332:function(t,s,a){t.exports=a.p+"assets/img/f7fcbcecc379498b99cf8ec3dcc5c4f1~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.b32f828f.png"},2586:function(t,s,a){"use strict";a.r(s);var n=a(46),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),n("p",[t._v("在Javascript之外的后端语言中，流是一个很普遍的概念，通过流我们可以将数据分段传输，如此以来我们不必等到数据全部传输完毕在处理，当第一批数据传输到我们手上的时候，我们就可以开始使用了。")]),t._v(" "),n("p",[t._v("在前端领域，流则可以在网络请求中发挥巨大的作用,当传输一些音视频大文件时，请求的时间是很长的。如果用户是下载文件那么长耗时没什么问题，但如果用户想点播音视频呢，通过流我们不必等到传输完毕,可以在传输过程中处理数据并展示给用户，大大优化了体验。")]),t._v(" "),n("p",[t._v("在JS早期，想要实现流我们需要自己造轮子，如果JS也有了Stream API用于处理流，且Fetch更深全面支持了Stream API。其response.body中负责携带数据的ReadableStream就是一个二进制数据流。搭配专为流媒体播放而生的MediaSource API,使得前端也有了很强的流媒体能力。")]),t._v(" "),n("h2",{attrs:{id:"readablestream的处理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#readablestream的处理"}},[t._v("#")]),t._v(" ReadableStream的处理")]),t._v(" "),n("p",[t._v("Fetch方法的response响应对象中，数据都以ReadableStream的二进制流存储，response对象提供了json()、formData()、text()等多重转换方法，通常情况下根据响应的ContentType,转换成我们想要的数据类型进行处理，一些简单的网络请求我们便会这样做，由于数据量娇小，转换时间往往较短。")]),t._v(" "),n("p",[t._v("除此之外我们还能通过Stream API,直接从ReadabledStream中读取数据，当HTTP(s)连接建立，我们拿到response的那一刻，数据传输就开始了，数据会以二进制流的形式不断添加到ReadableStream中。我们可以通过ReadableStream.getReader()获取一个流的读取器，此时该流会被锁定，只允许我们获得的这个读取器读取。在通过读取器的read()方法，循环读取流，分段拿去数据，实现流式传输，看一段示例代码：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fetchOption"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("response")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ok"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'网络连接失败'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" reader "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getReader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用读取器")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 声明处理函数")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("processRead")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("params")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("done"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("done"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此时value就是读取到的数据，再次进行处理")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理完毕后递归进行下一次处理")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" reader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processRead"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'可读流读取完毕'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 开始读取")]),t._v("\n        reader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processRead"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("上面的代码中，我们生命了一个processRead函数用来处理reader.read()产生的数据，每一次read都会返回一个{done:boolean, value: Uint8Array}对象。done标识了可读流是否读取完成，value则是当前读取到的分块数据，为Unit8Array的数组，接下来我们需要做的就是将其传递给我们的流媒体播放器消费")]),t._v(" "),n("h2",{attrs:{id:"mediasource-接受音视频数据"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mediasource-接受音视频数据"}},[t._v("#")]),t._v(" MediaSource 接受音视频数据")]),t._v(" "),n("p",[t._v("从前面的操作中，我们得到了多个Unit8Array的音视频数据，该如何使用它呢？通常都会转化为Object.URL来供HTMLMediaElement消费：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// value即为我们的Unit8Array数据")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" blob "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Blob")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("type"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'audio/mpeg'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" url "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("URL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createObjectURL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("blob"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("audio src"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),n("p",[n("span",{staticStyle:{color:"red"}},[t._v("但问题是我们有多个ArrayBuffer数据需要处理，很显然不可能将它们转换为多个URL，然后传递给audio,vedio标签消费掉。不过好在我们有专门处理流媒体播放的MediaSource API")])]),t._v(" "),n("p",[n("span",{staticStyle:{color:"green"}},[t._v("MediaSource的使用很简单，其内部创建SourceBuffer用于接收数据，且自身可以被传递到HTMLMediaElement对象上被消费，一段简单的例子")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建mediaSource并将其传递到audio标签上")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mediaSource "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MediaSource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" url "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("URL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createObjectURL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mediaSource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("audio src"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 内部创建SourceBuffer接收数据")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sourceBuffer "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mediaSource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addSourceBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'audio/mpeg'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsourceBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("chunk1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsourceBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("chunk2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nsourceBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("chunk3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以流式接收数据")]),t._v("\n")])])]),n("p",[t._v("上面的流程，我可以用这样一张图来表示")]),t._v(" "),n("p",[n("img",{attrs:{src:a(1331),alt:"播放流程"}})]),t._v(" "),n("p",[t._v("这里的SourceBuffer是数据的主要接收者,一个MediaSource钟包含多个SourceBuffer实例,可以通过 MediaSource.sourceBuffers 这个只读属性访问。一个SourceBuffer代表一个媒体块，就像一个视频包含音频，影像，字符等多个媒体块，此时你可以通过多个SourceBuffer来分别操纵他们，你也可以通过其来控制媒体流的质量、切换清晰度音质等。援引W3C官方文档的一张图，可以清晰的显示他们的关系")]),t._v(" "),n("p",[n("img",{attrs:{src:a(1332),alt:"mediaSource"}})]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检查是否为 open 状态,否则添加监听器，等到open状态就绪后再传输")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mediaSource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'open'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createSourceBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    mediaSource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sourceopen'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createSourceBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("createSourceBuffer")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sourcebuffer "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mediaSource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addSourceBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'audio/mpeg'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fetchOption"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("response")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ok"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'网络连接失败'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" reader "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getReader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取读取器")]),t._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 声明处理函数")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("processRead")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("params")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("done"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("done"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 传输数据")]),t._v("\n                    sourcebuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 读取完毕后递归进行下一次读取")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" reader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processRead"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'可读流读取完毕'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 关闭流式传输")]),t._v("\n                    sourceBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("abort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    mediaSource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("endOfStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 开始读取")]),t._v("\n            reader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processRead"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("需要注意的是在创建SourceBuffer时传入了一个'audio/mpeg'字符串，这是MIME类型字符串,标识了SouceBuffer所接收的数据类型，此外我们还可以额外指定编码方式，格式为 codecs=\"avc1.42E01E, mp4a.40.2\"',不具体指明的话 SourceBuffer会自动帮你选择。具体的 MIME 类型查询和解码方式可以参考"),n("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types",target:"_blank",rel:"noopener noreferrer"}},[t._v("MIME 常见类型"),n("OutboundLink")],1),t._v("和"),n("a",{attrs:{href:"https://www.rfc-editor.org/rfc/rfc6381",target:"_blank",rel:"noopener noreferrer"}},[t._v("codesc 查询"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"添加缓冲区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#添加缓冲区"}},[t._v("#")]),t._v(" 添加缓冲区")]),t._v(" "),n("p",[t._v("在上面的例子中，每当reader读取到新的分块value时，我们都直接执行了 SourceBuffer.appendBuffer() 来加载数据，但是 SourceBuffer 的读取是异步的，我们不能在读取的过程中加载数据，否则当传输速度大于读取速度时会产生报错。")]),t._v(" "),n("p",[t._v("所以在流式传输的生产者和消费者之间，添加一个缓冲区是很有必要的,能帮助我们解决异步冲突的问题，现在升级一下我们之前的示例，通过 SourceBuffer 的updateend 读取结束事件，配合缓冲区实现完整的流式传输")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isDone "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 是否传输结束")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" isReady "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 是否准备好下一下加载")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" bufferList "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 缓冲区数组")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mediaSource "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MediaSource")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" url "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("URL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createObjectURL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mediaSource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检测是否为open状态，否则添加监听器，等到open状态就绪后再传输")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mediaSource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'open'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createSourceBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    mediaSource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sourceopen'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("createSourceBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送请求并开始传输")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("createSourceBuffer")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sourcebuffer "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mediaSourceBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'audio/mpeg'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 传输完毕事件监听器")]),t._v("\n    sourceBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'updateend'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bufferList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 读取完毕后缓冲区有数据，从缓冲区读取")]),t._v("\n            sourceBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bufferList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("shift")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 缓冲区无数据")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("isDone"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 传输结束，关闭")]),t._v("\n                sourceBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("abort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                mediaSource"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("endOfStream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                isReady "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    window"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fetch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fetchOption"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("response")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ok"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'网络连接失败'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" reader "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getReader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取读取器")]),t._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 声明处理函数")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("processRead")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("params")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("done"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("done"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("isReady"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果已准备好则直接读取")]),t._v("\n                        sourceBuffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendBuffer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isReady "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 否则加入缓冲区")]),t._v("\n                        bufferList "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("bufferList"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 读取完毕后递归进行下一次读取")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" reader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("processRead"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'可读流读取完毕'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    isDone "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 开始读取")]),t._v("\n            reader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("procesRead"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("p",[t._v("我们通过Stream API 和 Media Source Extention (MSE)的配合，实现了一个简单的流式传输，可以让用户无需等待，下载的同事一边播放音视频，优化了用户体验。但以上两个 API 在前端流媒体的应用，还有很多玩法，值得我们去探索")]),t._v(" "),n("h2",{attrs:{id:"资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[t._v("#")]),t._v(" 资料")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://juejin.cn/post/7182849913846251575",target:"_blank",rel:"noopener noreferrer"}},[t._v("前端流式传输播放音视频"),n("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);