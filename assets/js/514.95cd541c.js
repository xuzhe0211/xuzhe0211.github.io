(window.webpackJsonp=window.webpackJsonp||[]).push([[514],{2409:function(e,t,a){"use strict";a.r(t);var o=a(46),v=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("Chrome51开始，浏览器的Cookie新增了一个SameSite属性，用来防止CSRF攻击和用户追踪")]),e._v(" "),a("h2",{attrs:{id:"csrf是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#csrf是什么"}},[e._v("#")]),e._v(" CSRF是什么")]),e._v(" "),a("p",[e._v("Cookie往往用来存储用户的身份信息，恶意网站可以设法伪造带有正确cookie的HTTP请求，这就是CSRF攻击。")]),e._v(" "),a("p",[e._v("举例来说，用户登录了银行网站your-ban.com，银行服务器发来了一个Cookie")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Set-Cookie: id=a3fwa\n")])])]),a("p",[e._v("用户后来又访问了恶意网站malicious.com，上面有个表单")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('<form action="your-bank.com/transfer" method="POST">\n...\n</form>\n')])])]),a("p",[e._v("用户一旦被诱骗发送这个表单，银行网站就会收到带有正确Cookie的请求，为了防止这种攻击，表单一般都带有一个随机token，告诉服务器这是真实请求")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('<form action="your-bank.com/transfer" method="POST">\n  <input type="hidden" name="token" value="dad3weg34">\n  ...\n</form>\n')])])]),a("p",[e._v("这种第三方网站引导发出的 Cookie，就称为第三方 Cookie。它除了用于 CSRF 攻击，还可以用于用户追踪。")]),e._v(" "),a("p",[e._v("比如，Facebook 在第三方网站插入一张看不见的图片。")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('<img src="facebook.com" style="visibility:hidden;">\n')])])]),a("p",[e._v("浏览器加载上面代码时，就会向 Facebook 发出带有 Cookie 的请求，从而 Facebook 就会知道你是谁，访问了什么网站。")]),e._v(" "),a("h2",{attrs:{id:"samesite属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#samesite属性"}},[e._v("#")]),e._v(" SameSite属性")]),e._v(" "),a("p",[e._v("Cookie的SameSite属性用来限制第三方Cookie，从而减少安全风险")]),e._v(" "),a("p",[e._v("它可以设置三个值")]),e._v(" "),a("ul",[a("li",[e._v("Strict")]),e._v(" "),a("li",[e._v("Lax")]),e._v(" "),a("li",[e._v("None")])]),e._v(" "),a("h3",{attrs:{id:"strict"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#strict"}},[e._v("#")]),e._v(" Strict")]),e._v(" "),a("p",[e._v("Strict最为严格，完全禁止第三方Cookie，跨站点时，任何情况下都不会发送Cookie。换言之，只有当前网页的URL与请求目标一致，才会带上Cookie")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Set-Cookie:CookieName=CookieValue; SameSite = Strict\n")])])]),a("p",[e._v("这个规则过于严格，可能造成非常不好的用户体验。比如，当前网页有一个GitHub连接，用户点击跳转就会带有GitHub的Cookie，跳转过去总是为登录状态")]),e._v(" "),a("h3",{attrs:{id:"lax"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lax"}},[e._v("#")]),e._v(" Lax")]),e._v(" "),a("p",[e._v("Lax规则稍稍放宽，大多数情况也是不发送第三方Cookie，但是导航到目标网址的Get请求除外")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Set-cookie:CoolieName=CookieValue; SameSite=Lax\n")])])]),a("p",[e._v("导航到目标网址的Get请求，只包含三种情况:链接，预加载请求，GET表单，想见下表")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("请求类型")]),e._v(" "),a("th",[e._v("示例")]),e._v(" "),a("th",[e._v("正常情况")]),e._v(" "),a("th",[e._v("LAX")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("链接")]),e._v(" "),a("td",[e._v('<a href="..."></a>')]),e._v(" "),a("td",[e._v("发送Cookie")]),e._v(" "),a("td",[e._v("发送Cookie")])]),e._v(" "),a("tr",[a("td",[e._v("预加载")]),e._v(" "),a("td",[e._v('<link rel="prerender" href="..."/>')]),e._v(" "),a("td",[e._v("发送Cookie")]),e._v(" "),a("td",[e._v("发送Cookie")])]),e._v(" "),a("tr",[a("td",[e._v("GET 表单")]),e._v(" "),a("td",[e._v('<form method="GET" action="...">')]),e._v(" "),a("td",[e._v("发送Cookie")]),e._v(" "),a("td",[e._v("发送Cookie")])]),e._v(" "),a("tr",[a("td",[e._v("POST表单")]),e._v(" "),a("td",[e._v('<form method="POST" action="...">')]),e._v(" "),a("td",[e._v("发送Cookie")]),e._v(" "),a("td",[e._v("不发送")])]),e._v(" "),a("tr",[a("td",[e._v("Iframe")]),e._v(" "),a("td",[e._v('<iframe src="..."></iframe>')]),e._v(" "),a("td",[e._v("发送Cookie")]),e._v(" "),a("td",[e._v("不发送")])]),e._v(" "),a("tr",[a("td",[e._v("AJAX")]),e._v(" "),a("td",[e._v('$.get("...")')]),e._v(" "),a("td",[e._v("发送Cookie")]),e._v(" "),a("td",[e._v("不发送")])]),e._v(" "),a("tr",[a("td",[e._v("Image")]),e._v(" "),a("td",[e._v('<img src="...">')]),e._v(" "),a("td",[e._v("发送Cookie")]),e._v(" "),a("td",[e._v("不发送")])])])]),e._v(" "),a("p",[e._v("设置了Strict或者Lax以后，基本就杜绝了CSRF攻击。当然，前提是用户浏览器支持SameSite属性。")]),e._v(" "),a("h3",{attrs:{id:"none"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#none"}},[e._v("#")]),e._v(" None")]),e._v(" "),a("p",[e._v("Chrome计划将Lax变为默认设置，这时，网站可以选择显式关闭SameSite属性，将其设置为None。不过，前提是必须同事设置Secure属性(Cookie只能通过HTTPS协议发送)，否则无效。")]),e._v(" "),a("p",[e._v("下面的设置无效")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Set-Cookie: widget_session=abc123;SameSite=None\n")])])]),a("p",[e._v("下面的设置有效")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Set-Cookie： widget_session=abc123;SameSite=None; secure\n")])])]),a("h2",{attrs:{id:"资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[e._v("#")]),e._v(" 资料")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2019/09/cookie-samesite.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("原文"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=v.exports}}]);