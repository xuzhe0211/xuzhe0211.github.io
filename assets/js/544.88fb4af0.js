(window.webpackJsonp=window.webpackJsonp||[]).push([[544],{2471:function(v,_,t){"use strict";t.r(_);var a=t(46),s=Object(a.a)({},(function(){var v=this,_=v.$createElement,t=v._self._c||_;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[v._v("TIP")]),v._v(" "),t("p",[v._v("虽然我们生活在一个宽带无处不在、4/5G 几乎全覆盖的时代，但网站加载缓慢还是常态，就算我们打开一个以文本为中心的新闻网站，都可能需要至少 30 秒才能开始阅读。毕竟在内容膨胀时代，一张照片就能轻易超过 1MB 大小，许多网站为了显示几段文本，还会单独加载至少 10MB 的 JS 和自定义字体。")]),v._v(" "),t("p",[v._v('对此，对优化和极简主义充满热情的资深 Web 开发 Nathaniel 告诉我们，你应该让你的额网页金立控制在14kb以内，而且即便对于富媒体为中心的网站，这条14kb的规则仍然值得遵循。如果14kb不足以用于最终布局，则需要优先考虑"首屏"字节，可以用发送给访问者的前14KB数据来渲染一些有用的东西，减少用户还没开始阅读就流失掉的机会')])]),v._v(" "),t("p",[v._v("网页越小，加载速度就越快--这一点都不奇怪")]),v._v(" "),t("p",[v._v("但令人感到惊讶的是，"),t("span",{staticStyle:{color:"red"}},[t("em",[t("strong",[v._v("14KB网页的加载速度比15KB要快很多----可能快612毫秒---而15KB和16KB网页之间的加速速度差异微乎其微")])])])]),v._v(" "),t("p",[t("strong",[v._v("这是TCP慢启动算法导致的")]),v._v("。本文将介绍这个算法、它的原理以及为什么你应该关注塔。")]),v._v(" "),t("h2",{attrs:{id:"tcp是什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tcp是什么"}},[v._v("#")]),v._v(" TCP是什么？")]),v._v(" "),t("p",[v._v("传输控制协议(Transmission Control Protocol, TCP),是一种使用IP协议可靠的发送数据包的方法--有时被称为TCP/IP。")]),v._v(" "),t("p",[v._v("当浏览器向你的网站(或图像或样式表)发出请求时，它会使用HTTP请求。HTTP建立在TCP之上，一个HTTP请求通常由许多TCP数据包组成。"),t("span",{staticStyle:{color:"blue"}},[v._v("IP只是一个将数据包从互联网上的一个位置发送到另一个位置的系统。IP\n没有检查数据包是否成功达到目的地的方法。")])]),v._v(" "),t("p",[v._v("对于网站来说，确保所有的数据到达请求段是非常关键的，否则我们可能会因为丢失数据包无法获得完整的网页。但在网络的其他应用场景中，这一点并不那么重要--比如流媒体直播视频。")]),v._v(" "),t("p",[t("span",{staticStyle:{color:"blue"}},[v._v("TCP是IP的扩展，浏览器和网站服务器通过它告诉对方哪些数据包成功达到")])]),v._v(" "),t("p",[v._v("服务器发送一些数据包，然后等待浏览器已经收到数据包的响应(这叫确认或ACK)，然后它继续发送更多的数据包--或者如果他没有收到ACK,将再次发送相同的数据包")]),v._v(" "),t("h2",{attrs:{id:"什么是tcp慢启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是tcp慢启动"}},[v._v("#")]),v._v(" 什么是TCP慢启动")]),v._v(" "),t("p",[t("span",{staticStyle:{color:"red"}},[v._v("TCP慢启动是一种算法，服务器用它来确定一次可以发送多少数据包。")])]),v._v(" "),t("p",[v._v("当浏览器第一次连接到服务器时，服务器无法知道它们之间的带宽是多少。"),t("span",{staticStyle:{color:"red"}},[v._v("带宽是指在单位时间内网络可以传输的数据量.通常是比特/秒(b/s)为单位")]),v._v("。我们可以用管道来做类比--把带宽想象成每秒从管道流出多少水")]),v._v(" "),t("p",[v._v("服务器不知道网络连接可以处理多少数据--所以它先发送少量且安全的数据--通常是10个TCP数据包。如果这些数据包成功到达网站访问者，他们的计算机返回确认(ACK),表示数据包已经被收到了。然后服务器发送更多的数据包，但这一次它将数量增加了一倍")]),v._v(" "),t("p",[v._v("这个过程不断重复，直到数据包丢失，服务器没有收到ACK。(此时，服务器会继续发送数据包，但速度较慢)")]),v._v(" "),t("p",[v._v("这就是TCP慢启动的要点---在现实当中，虽然算法各不相同，但是这是他的基本原理")]),v._v(" "),t("h2",{attrs:{id:"那么14kb这个数字怎么来的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#那么14kb这个数字怎么来的"}},[v._v("#")]),v._v(" 那么14KB这个数字怎么来的")]),v._v(" "),t("p",[v._v("大多数Web服务器的TCP慢启动都是从发送10个TCP数据包开始的。")]),v._v(" "),t("p",[v._v("TCP数据包最大长度为1500字节。这个最大值不是由TCP规范设置的，它来自于以太网标准")]),v._v(" "),t("p",[v._v("每个TCP数据包的标头占了40个字节，其实16个字节用于IP，另外24个字节用于TCP")]),v._v(" "),t("p",[t("span",{staticStyle:{color:"red"}},[v._v("这样每个TCP数据包还剩下1460个字节。10 * 1460 = 14600字节，或大约14kb")])]),v._v(" "),t("p",[v._v("因此，如果你能把网站的网页--或网页的关键部分--压缩到14kb，就可以为访问者节约大量时间--他们和服务器之间的往返时间")]),v._v(" "),t("p",[v._v("一个数据往返能有多糟糕？？但人们非常没有耐心--一个数据往返可能会出奇的长，具体多长取决于延迟..."),t("span",{staticStyle:{color:"red"}},[v._v("延迟是指数据包从源传输到目的地所花费的时间。如果带宽是每秒钟可以通过管道的水的数量，那么延迟就是一滴水进入管道后从另一端流出所花费的时间。")])]),v._v(" "),t("p",[v._v("下面是一个关于延迟有多糟糕的例子")]),v._v(" "),t("h3",{attrs:{id:"卫星网络"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#卫星网络"}},[v._v("#")]),v._v(" 卫星网络")]),v._v(" "),t("p",[v._v("卫星网络是由环绕地球轨道的卫星提供的，在人烟稀少的地区、石油钻井平台、游轮以及飞机上，人们可以使用这种网络。")]),v._v(" "),t("p",[v._v("为了说明这种糟糕的延迟，我们想象一群在石油钻井平台工作的兄弟把骰子忘在了家里，他们需要通过 missingdice.com（少于 14KB）来玩《龙与地下城》游戏。")]),v._v(" "),t("p",[v._v("首先，他们中的一个用手机发出一个网页请求……")]),v._v(" "),t("p",[v._v("手机将请求发送到钻井平台的 WiFi 路由器，路由器将数据发送给平台上的卫星天线，我们假设这可能需要 1 毫秒时间。")]),v._v(" "),t("p",[v._v("然后，卫星天线将数据发送到地球轨道上方的卫星。")]),v._v(" "),t("p",[v._v("通常，这是通过在地球表面上方 35786 公里处运行的轨道卫星实现的。光速为 299792458 米 / 秒，所以信息从地球发送到卫星需要 120 毫秒。然后，卫星将信息传回地面接收站，这又需要 120 毫秒。")]),v._v(" "),t("p",[v._v("然后，地面站必须将请求发送到位于地球任意位置的服务器（当光通过光纤电缆传输时，速度会降至每秒 200000000 米）。如果地面站和服务器之间的距离等于纽约到伦敦之间的距离，那么大约需要 28 毫秒，如果地面站和服务器之间的距离等于纽约到悉尼之间的距离，则需要 80 毫秒——所以我们姑且定一个 60 毫秒的数字（这个数字便于计算）。")]),v._v(" "),t("p",[v._v("然后，服务器需要处理请求，这可能需要 10 毫秒，然后服务器再次将它发送出去。")]),v._v(" "),t("p",[v._v("回到地面站，进入太空，回到卫星天线，然后回到无线路由器，再到手机上。")]),v._v(" "),t("p",[v._v("手机 -> WiFi 路由器 ->卫星天线 ->卫星 -> 地面站 -> 服务器 -> 地面站 -> 卫星 -> 卫星天线 -> WiFi 路由器 -> 手机\n如果我们算一下，就是 10 + ( 1 + 120 + 120 + 60 ) x 2 = 612 毫秒。")]),v._v(" "),t("p",[v._v("这是每次往返额外的 612 毫秒——也许这看起来不是很长时间，但你的网站可能只是为了获取第一个资源就需要许多个往返。")]),v._v(" "),t("p",[t("span",{staticStyle:{color:"red"}},[v._v("另外，HTTPS 在完成第一个往返之前需要额外的两次往返——这使延迟达到了 1836 毫秒！")])]),v._v(" "),t("h3",{attrs:{id:"生活在陆地上的人-延迟有事怎么样的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生活在陆地上的人-延迟有事怎么样的"}},[v._v("#")]),v._v(" 生活在陆地上的人，延迟有事怎么样的")]),v._v(" "),t("p",[v._v("卫星网络似乎是一个极端的例子——我选择它作为例子是因为它能够充分说明了网络延迟这个问题——但对于生活在陆地上的人来说，延迟可能比这更糟糕，原因有很多。")]),v._v(" "),t("p",[v._v("2G 网络的延迟通常在 300 毫秒到 1000 毫秒之间；")]),v._v(" "),t("p",[v._v("3G 网络的延迟可以在 100 毫秒到 500 毫秒之间；")]),v._v(" "),t("p",[v._v("嘈杂的移动网络——比如在一个异常拥挤的地方，比如音乐节；")]),v._v(" "),t("p",[v._v("处理大流量的服务器；")]),v._v(" "),t("p",[v._v("其他一些不好的东西。")]),v._v(" "),t("p",[v._v("不稳定的网络连接也会导致数据包丢失——导致需要另一个往返来获取丢失的数据包。")]),v._v(" "),t("h2",{attrs:{id:"了解了14kb法则-接下来可以做些什么"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#了解了14kb法则-接下来可以做些什么"}},[v._v("#")]),v._v(" 了解了14KB法则，接下来可以做些什么")]),v._v(" "),t("p",[v._v("当然，你应该让你的网页尽可能的小---你爱你的访客，你希望他们开心。将每个页面的大小控制在14kb以内是一个不错的注意。")]),v._v(" "),t("p",[t("span",{staticStyle:{color:"red"}},[v._v("这14kb可以是压缩数据--所以实际上可以对应大约50kb的未压缩数据---这已经非常慷慨了。要知道阿波罗11的制导计算机只有72KB的内存")])]),v._v(" "),t("p",[v._v("去掉自动播放的视频、弹出窗口、Cookie、Cookie横幅、社交网络按钮、跟踪脚本、Javascript和CSS框架，以及所有其他人们不喜欢的垃圾---你可能就能实现14KB法则")]),v._v(" "),t("p",[v._v("假设你已经尽力将所有内容控制在 14KB 以内，但仍然做不到——但 14KB 法则仍然很有用。")]),v._v(" "),t("p",[v._v("你可以用发送给访问者的前 14KB 数据来渲染一些有用的东西——例如一些关键的 CSS、JS 和解释如何使用你的应用程序的前几段文本。")]),v._v(" "),t("p",[v._v("需要注意的是，14KB 法则包含了 HTTP 标头——这些是未压缩的（即使是 HTTP/2 的第一个响应），也包含图片，所以你应该只加载在页面上方的内容，并保持它们最小，或者使用占位符，让访问者知道他们在等待一些更好的内容。")]),v._v(" "),t("h3",{attrs:{id:"关于这个法则的一些注意事项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关于这个法则的一些注意事项"}},[v._v("#")]),v._v(" 关于这个法则的一些注意事项")]),v._v(" "),t("p",[v._v("14KB法则更想是一种经验之谈，而不是计算的基本法则")]),v._v(" "),t("ul",[t("li",[v._v("一些服务器已经将TCP慢启动初始窗口从10个数据包增加到30个")]),v._v(" "),t("li",[v._v("有时服务器知道它可以从更大数量的数据包开始传输，因为它使用TLS握手来建立一个更大的窗口")]),v._v(" "),t("li",[v._v("服务器可以缓存路由可管理的数据包数量，并在下一次连接时发送更多的数据包；")]),v._v(" "),t("li",[v._v("还有其他需要注意的地方这里有一篇文章更深入地探讨关于为什么 14KB 法则并不总是这么回事。")])]),v._v(" "),t("p",[v._v("（https://www.tunetheweb.com/blog/critical-resources-and-the-first-14kb/）。")]),v._v(" "),t("h3",{attrs:{id:"http-2和14kb法则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http-2和14kb法则"}},[v._v("#")]),v._v(" HTTP/2和14kb法则")]),v._v(" "),t("p",[v._v("有一种观点认为，在使用 HTTP/2 时，14KB 法则不再适用。我已经读了所有我能读到的关于这个问题的东西，但我还没有看到任何证据表明使用 HTTP/2 的服务器已经停止使用 TCP 慢启动（从 10 个数据包开始）。")]),v._v(" "),t("h3",{attrs:{id:"http-3和quic"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#http-3和quic"}},[v._v("#")]),v._v(" HTTP/3和QUIC")]),v._v(" "),t("p",[v._v("与 HTTP/2 类似，有一种观点认为 HTTP/3 和 QUIC 将废除 14KB 法则——事实并非如此。实际上，QUIC 仍然建议使用 14KB 法则。")]),v._v(" "),t("h2",{attrs:{id:"资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[v._v("#")]),v._v(" 资料")]),v._v(" "),t("p",[t("a",{attrs:{href:"https://mp.weixin.qq.com/s/0i2oVnlR_1YQSFsXzJhYwQ",target:"_blank",rel:"noopener noreferrer"}},[v._v("为什么你开发的网页不应该大于 14KB？"),t("OutboundLink")],1)])])}),[],!1,null,null,null);_.default=s.exports}}]);