(window.webpackJsonp=window.webpackJsonp||[]).push([[800],{2932:function(t,s,a){"use strict";a.r(s);var n=a(46),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"github-actions是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#github-actions是什么"}},[t._v("#")]),t._v(" github actions是什么？")]),t._v(" "),a("p",[t._v("github actions是github的持续集成及自动化工作流服务，使用起来都比较方便。大部分github actions都可以在https://github.com/marketplace?type=actions中找到。")]),t._v(" "),a("h2",{attrs:{id:"咱们使用github-actions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#咱们使用github-actions"}},[t._v("#")]),t._v(" 咱们使用github actions")]),t._v(" "),a("p",[t._v("在github项目目录下，根目录下新建一个文件.github/workflow/xx.yml,在xx.yml写你需要自动化工作流的服务。")]),t._v(" "),a("h3",{attrs:{id:"基本语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本语法"}},[t._v("#")]),t._v(" 基本语法")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" github action的名字\n\non"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    push"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      breaches"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 触发部署的分支\n      paths"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 下列文件的变更触发部署\n      paths"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ignore"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" 下列文件的变更不触发部署\njobs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 工作流程运行包括一项或多项作业，作业默认是并行运行。\n    deploy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        runs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("on"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 使用的系统镜像\n        setps"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 自动化步骤\n          "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("步骤名称\n            users：使用封装好的步骤镜像\n            env"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 环境变量\n              环境变量的map可用于工作流程中的所有作业和步骤\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v("：\n              有些步骤必须通过"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v("关键词设置输入。请查阅操作的自述文件，确定所需的输入\n            run"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n              要运行的脚本\n")])])]),a("h3",{attrs:{id:"两个例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#两个例子"}},[t._v("#")]),t._v(" 两个例子")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("部署到阿里云")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" deploy to aliyun\n\non"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  push"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    branches"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" ali"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ecs # 只在ali"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ecs上push触发部署\n    paths"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ignore"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" # 下列文件的变更不触发部署，可以自行添加\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("README")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("md\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("LICENSE")]),t._v("\njobs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  deploy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    runs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("on"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("latest # 使用ubuntu系统镜像运行自动化脚本\n    steps"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" # 自动化步骤\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" users"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" actions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("checkout@v2 # 第一步，下载代码仓库\n\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("Deploy to Server # 第二步，rsync推文件\n       uses"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" AEnterprise"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("rsync"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("deploy@v1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("  # 使用别人包装好的步骤镜像\n       env"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DEPLOY_KEY")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ACCESS_TOKEN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   # 引用配置，"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSH")]),t._v("私钥\n            "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ARGS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("avz "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delete")]),t._v("   # rsync参数\n            "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SERVER_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'22'")]),t._v("  # "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSH")]),t._v("端口\n            "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FOLDER")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("  # 要推送的文件夹，路径相对于代码仓库的根目录\n            "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SERVER_IP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REMOTE_HOST")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  # 引用配置，服务器的host名（"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IP")]),t._v("或者域名domain"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com）\n            "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("USERNAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSH_USERNAME")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  # 引用配置，服务器登录名\n            "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SERVER_DESTINATION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("zhihu"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("api  # 部署到目标文件夹\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Restart server   # 第三步，重启服务\n        uses"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" appleboy"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ssh"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("action@master\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REMOTE_HOST")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  # 下面三个配置与上一步类似\n            username"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SSH_USERNAME")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            key"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ACCESS_TOKEN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            # 重启的脚本，根据自身情况做相应改动，一般要做的是migrate数据库以及重启服务器\n            script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n            cd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("zhihu"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("api\n            npm install \n            npm run start\n")])])])]),t._v(" "),a("li",[a("p",[t._v("部署轮子到npm")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" publish\n\non"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\npush"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    branches"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" master\n    paths"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'lib/*'")]),t._v("\n\njobs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\nbuild"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n\n    runs"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("on"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("latest\n\n    steps"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" uses"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" actions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("checkout@v2\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" uses"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" actions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("setup"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("node@v1\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        node"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("version"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'12'")]),t._v("\n        registry"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'https://registry.npmjs.org'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Release\n    run"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n        git config "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("local user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("email "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"action@github.com"')]),t._v("\n        git config "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("local user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GitHub Action"')]),t._v("\n        npx version"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("from"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("git "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("allow"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("same"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("version "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("template "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'master.short'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Publish to npmjs\n    run"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" \n        npm publish "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("access "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v("\n    env"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GITHUB_TOKEN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GITHUB_TOKEN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NODE_AUTH_TOKEN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NPM_TOKEN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),a("h2",{attrs:{id:"使用小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用小结"}},[t._v("#")]),t._v(" 使用小结")]),t._v(" "),a("ol",[a("li",[t._v("获取打包的id，用作docker tag")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("$"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GITHUB_RUN_NUMBER")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("模糊匹配分支名")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("branch\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" feature"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("**")]),t._v("\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("打印相关参数")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("echo $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toJson")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ol",{attrs:{start:"4"}},[a("li",[t._v("条件判断 用于不同股份制进行打包")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("contains")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'master'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("startsWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'feature'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("endsWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head_commit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[t._v("动态写入环境变量")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("echo "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"BUILD_EVT=test"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GITHUB_ENV")]),t._v("\necho "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$( echo ${GITHUB_REF##*/} )"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GITHUB_ENV")]),t._v("\n")])])]),a("ol",{attrs:{start:"6"}},[a("li",[t._v("包含子模块，需要设置token")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" uses"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" actions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("checkout@v2\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" \n    submodules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    token"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REPO_TOKEN")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ol",{attrs:{start:"7"}},[a("li",[t._v("匹配tag")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("on"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  push"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\ntags"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" \n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),t._v("\n")])])]),a("ol",{attrs:{start:"8"}},[a("li",[t._v("github参数中有用的信息")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("github"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ref"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" #当前分支信息，如果为标签，则为具体标签数字\ngithub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("head_commit"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" #当前提交信息\ngithub"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("event_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" #当前提交时间，如push"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pull_request\n")])])]),a("h2",{attrs:{id:"资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[t._v("#")]),t._v(" 资料")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Actions 入门教程"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://cloud.tencent.com/developer/article/1970752",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Actions 自动构建 并发布到 NPM"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("https://frostming.com/2020/04-26/github-actions-deploy/")]),t._v(" "),a("p",[t._v("https://frostming.com/2020/04-26/github-actions-deploy/")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/khitrenovich/github-actions-expect-test/blob/master/my-script.exp",target:"_blank",rel:"noopener noreferrer"}},[t._v("demo"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://docs.github.com/zh/actions/using-workflows/workflow-syntax-for-github-actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("github"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);