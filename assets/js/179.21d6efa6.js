(window.webpackJsonp=window.webpackJsonp||[]).push([[179],{1565:function(t,s,a){t.exports=a.p+"assets/img/20210816091759425.9debce14.png"},1566:function(t,s,a){t.exports=a.p+"assets/img/1714fac5a07f1c09_tplv-t2oaga2asx-zoom-in-crop-mark_3024_0_0_0.f9e890a6.png"},1567:function(t,s,a){t.exports=a.p+"assets/img/1714fac5a1368d3e_tplv-t2oaga2asx-zoom-in-crop-mark_3024_0_0_0.0a5c9d0f.png"},2674:function(t,s,a){"use strict";a.r(s);var e=a(46),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[t._v("#")]),t._v(" 问题")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("您的连接不是私密连接；因为此网站发送了 Google Chrome 无法处理的杂乱凭据。网络错误和攻击通常是暂时的，因此，此网页稍后可能会恢复正常。")]),t._v(" "),e("p",[e("img",{attrs:{src:a(1565),alt:"HTTP访问不了"}})]),t._v(" "),e("p",[e("span",{staticStyle:{color:"blue"}},[t._v("当前页面点击任意空白处，直接键盘输入“thisisunsafe”即可解决。")])]),t._v(" "),e("p",[t._v("原理是chrome认为这个网站是不安全的，不让你访问。而你输入了这句话，就类似于签了生死状，了解了风险。chrome就放你进去，但那之后再出问题也就没有责任了。")])]),t._v(" "),e("li",[e("p",[e("span",{staticStyle:{color:"red"}},[t._v("whistle")])]),t._v(" "),e("p",[e("RouterLink",{attrs:{to:"/tools/Other/whistle.html"}},[t._v("whistle")]),t._v(" + SwitchyOmega(代理)  支持https访问？？？")],1)]),t._v(" "),e("li",[e("p",[t._v("简单方式")]),t._v(" "),e("p",[t._v("react项目")]),t._v(" "),e("div",{staticClass:"language-md extra-class"},[e("pre",{pre:!0,attrs:{class:"language-md"}},[e("code",[t._v("最简单切 https方案 export HTTPS=true && npm start 启动项目  然后node切换成10.6.0 https就可以正常访问了,直接键盘输入“thisisunsafe”即可解决。。\n")])])]),e("p",[e("a",{attrs:{href:"https://github.com/nodejs/node/issues/24097",target:"_blank",rel:"noopener noreferrer"}},[t._v("参考"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("class FastBuffer extends Uint8Array {} 报错---重启iterm")])])]),t._v(" "),e("h2",{attrs:{id:"背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),e("p",[t._v("Chrome升级到80版本以上会将原来默认值"),e("strong",[t._v("SameSite=None修改为SameSite=Lax")]),t._v("（其他浏览器，例如safari、firefox等都有此类似计划）,导致跨站cookie无法传递，从而导致类似登录失败等问题。通用的解决方案是将涉及业务开发的所有域名下的cookie设置成 "),e("strong",[t._v('"SameSite=Node;Secure;"')]),t._v("，但该方案前提条件要求访问协议必须是https，然后目前前端本地开发大部分是http，导致请求还是无法携带Cookie，因而需要将本地http服务升级为https.")]),t._v(" "),e("blockquote",[e("p",[t._v("关于samesite的更多介绍可以查看"),e("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2019/09/cookie-samesite.html?utm_content=buffer67e06&utm_medium=social&utm_source=twitter.com&utm_campaign=buffer",target:"_blank",rel:"noopener noreferrer"}},[t._v("阮老师的文章"),e("OutboundLink")],1)])]),t._v(" "),e("h2",{attrs:{id:"整体方案"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#整体方案"}},[t._v("#")]),t._v(" 整体方案")]),t._v(" "),e("h3",{attrs:{id:"_2-1-基于webpack-dev-server"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-基于webpack-dev-server"}},[t._v("#")]),t._v(" 2.1 基于webpack-dev-server")]),t._v(" "),e("p",[e("img",{attrs:{src:a(1566),alt:"基于webpack-dev-server"}})]),t._v(" "),e("ul",[e("li",[e("p",[t._v("方式一")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("devServer"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    https"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("此设置使用了自签名证书，故通过，例如https://h5.dev.weidian.com:9003/pages/index.html这样的开发地址访问时，浏览器会有安全风险提示,需主动信任后可访问(主动忽略风险，虽然能开启https服务，但可能在个别场景下会有异常)")])]),t._v(" "),e("li",[e("p",[t._v("方式二")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("devServer"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    https"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        key"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" fs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/to/server.key'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        cert"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" fs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/to/server.crt'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        ca"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" fs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/path/to/ca.pem'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("此设置需要由开发者自行提供证书，如果开发者提供了对应域名的证书，通过https访问该域名时，浏览器就不会有安全风险提示。")])])]),t._v(" "),e("h3",{attrs:{id:"_2-2-生成证书和秘钥"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-生成证书和秘钥"}},[t._v("#")]),t._v(" 2.2 生成证书和秘钥")]),t._v(" "),e("p",[t._v("加入采用方式二，就必须提供证书和秘钥，传统的证书生成方案(例如OpenSSL)需要各种命令配置，比较繁琐，故这里提供了一种相对简单方便的证书生成方案，步骤如下")]),t._v(" "),e("blockquote",[e("p",[t._v("创建证书基于"),e("a",{attrs:{href:"https://github.com/FiloSottile/mkcert",target:"_blank",rel:"noopener noreferrer"}},[t._v("mkcert"),e("OutboundLink")],1),t._v("这个工具，相关详细信息可查看官方教程")])]),t._v(" "),e("ul",[e("li",[e("p",[t._v("第一步：安装mkcert")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("brew install mkcert "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// On macOS, use Homebrew")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("第二步: 生成根证书")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("mkcert install\n")])])])]),t._v(" "),e("li",[e("p",[t._v("第三步: 本地新建一个文件夹，并进入到该目录(用于存储证书)")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("mkdir ca\ncd ca\n")])])])])]),t._v(" "),e("blockquote",[e("p",[t._v("也可不用放在项目中,通用的解决方案是放在磁盘中,比如用户目录(/Users)")])]),t._v(" "),e("ul",[e("li",[e("p",[t._v("第四步:生成所需域名对应的本地证书,比如http://h5.dev.weidian.com")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("mkcert h5"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dev"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("weidian"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com\n")])])]),e("p",[t._v("命令执行完之后，在该文件下会生成h5.dev.weidian.com-key.pem（私钥）和h5.dev.weidian.com.pem（证书）两个文件，也就是webpack-dev-server配置需要的文件。")])]),t._v(" "),e("li",[e("p",[t._v("第五步:打开自己的项目,将步骤四生成的文件拷贝到项目中，然后修改webpack配置")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("devServer"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    https"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        key"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" fs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./cat/h5.dev.weidian.com-key.pem'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        cert"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" fs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./cat/h5.dev.weidian.com.pem'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),e("p",[t._v("重启项目，打开开发地址，结果如下\n"),e("img",{attrs:{src:a(1567),alt:"https打开"}})]),t._v(" "),e("h3",{attrs:{id:"_2-3-一个自动生成证书和秘钥的库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-一个自动生成证书和秘钥的库"}},[t._v("#")]),t._v(" 2.3 一个自动生成证书和秘钥的库")]),t._v(" "),e("p",[t._v("除了手动生成证书和秘钥，还可以通过"),e("a",{attrs:{href:"https://github.com/davewasmer/devcert",target:"_blank",rel:"noopener noreferrer"}},[t._v("devcert"),e("OutboundLink")],1),t._v("这个库编写少量代码来生成证书和秘钥，方式如下")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webpack.config.js")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("webpackConfig")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" ssl "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" devcert"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("certificateFor")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"h5.dev.weidian.com"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" getCaPath"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("key和cert分别就是开启Https服务的证书和秘钥"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cert "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ssl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dev-server"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            https"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cert"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nmodule"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("webpackConfig")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),e("p",[t._v("未来随着chrome升级，samesite的的默认设置必然会对本地开发产生重大影响，提前进行技术储备是必然的，个人可以结合公司开发情况酌情使用。")]),t._v(" "),e("h2",{attrs:{id:"资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[t._v("#")]),t._v(" 资料")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://webpack.docschina.org/configuration/dev-server/#devserverhttps",target:"_blank",rel:"noopener noreferrer"}},[t._v("webpack官网"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://juejin.cn/post/6844904116481687565#heading-9",target:"_blank",rel:"noopener noreferrer"}},[t._v("本地https服务搭建指南"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/142850469",target:"_blank",rel:"noopener noreferrer"}},[t._v("知乎-看起来有意思"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("chrome://flags/#allow-insecure-localhost")])])}),[],!1,null,null,null);s.default=n.exports}}]);