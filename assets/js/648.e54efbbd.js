(window.webpackJsonp=window.webpackJsonp||[]).push([[648],{2659:function(s,t,a){"use strict";a.r(t);var n=a(46),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"开发环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发环境"}},[s._v("#")]),s._v(" 开发环境")]),s._v(" "),a("ol",[a("li",[s._v("Node.js")]),s._v(" "),a("li",[s._v("Package Manager(npm、yarn、pnpm)")])]),s._v(" "),a("h2",{attrs:{id:"痛点问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#痛点问题"}},[s._v("#")]),s._v(" 痛点问题")]),s._v(" "),a("p",[s._v("成员机器Node.js版本不统一：守旧派用12.X、保守用14.X、激进用17.X。项目能否正常跑起来全凭天意，在没有CICD流水线加持本地npm run build的场景下线上风险可想而知。")]),s._v(" "),a("p",[s._v("有人习惯用npm、有人习惯用yarn,代码库里面经常会存在package-lock.json、yarn.lock文件同时存在的情况。更痛的点还是各种奇奇怪怪的问题排查起来没有头绪。")]),s._v(" "),a("p",[s._v("我们要做的就是将问题掐死在源头:"),a("span",{staticStyle:{color:"blue"}},[s._v("锁定Node.js版本和包管理器")])]),s._v(" "),a("h2",{attrs:{id:"锁定node版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#锁定node版本"}},[s._v("#")]),s._v(" 锁定Node版本")]),s._v(" "),a("p",[s._v("通过在package.json中指定engines字段，可限定项目使用的node版本。下面配置仅允许用户使用14或者16的版本。更多的配置可以参考package.json | npm Docs、semver")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//package.json")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"engines"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"14.x || 16.x"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("配置之后你会发现，该字段只对yarn生效。那如何对npm也生效呢？在项目根目录下的.npmrc文件中增加如下配置")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//.npmrc")]),s._v("\nengine"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("strict "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])])]),a("p",[s._v("上面配置完成后，npm install试试吧，错误的Node.js将直接退出")]),s._v(" "),a("h2",{attrs:{id:"锁定包管理器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#锁定包管理器"}},[s._v("#")]),s._v(" 锁定包管理器")]),s._v(" "),a("p",[s._v("利用only-allow工具包、npm scripts快速实现锁定")]),s._v(" "),a("ol",[a("li",[s._v("在项目中npm install -D only-allow")]),s._v(" "),a("li",[s._v("在package.json文件中进行配置scripts.preinstall，允许输入的值only-allow npm、only-allow pnpm、only-allow yarn")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// package.json")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"preinstall"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"only-allow npm"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("以上配置完成后，可以在乱用(yarn、npm、pnpm)试试")]),s._v(" "),a("h2",{attrs:{id:"使用-npmrc文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-npmrc文件"}},[s._v("#")]),s._v(" 使用.npmrc文件")]),s._v(" "),a("p",[s._v("原来engines只是建议，默认不开启严格版本校验，只会给出提示，需要手动开启严格模式。在根目录下.npmrc添加 engine-strict = true 才会起作用。配置完成后再执行 npm install:")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .npmrc")]),s._v("\nengine-strict "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" ERR"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" code ENOTSUP\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" ERR"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" notsup Unsupported engine "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" react_antd_admin_template@1.0.0: wanted: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"14.17.5"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6.14.14"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("current: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"16.18.1"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8.19.2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" ERR"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" notsup Not compatible with your version of node/npm: react_antd_admin_template@1.0.0\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" ERR"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" notsup Not compatible with your version of node/npm: react_antd_admin_template@1.0.0\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" ERR"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" notsup Required: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"14.17.5"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6.14.14"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" ERR"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" notsup Actual:   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"16.18.1"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8.19.2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("此时通过npm安装，限制Node版本便起作用了")]),s._v(" "),a("h2",{attrs:{id:"使用-nvmrc文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-nvmrc文件"}},[s._v("#")]),s._v(" 使用.nvmrc文件")]),s._v(" "),a("p",[s._v("通过上面的方式，可以做到让大家使用相同的Node版本，但每次提示版本不符合，需要开发人员到package.json中查看版本号，然后在使用nvm切换到指定版本，太麻烦了，高效开发不是怎么干的，")]),s._v(" "),a("p",[s._v("可以创建一个.nvmrc文件，指定项目Node版本")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# .nvmrc")]),s._v("\nv14.17.5\n")])])]),a("p",[s._v("此时，执行 nvm use 祖东就切换到项目执行的Node版本")]),s._v(" "),a("p",[s._v(".nvmrc文件是一个存放指定 Node 版本的配置文件，可以告诉项目的成员应该使用哪个Node 版本来运行项目。")]),s._v(" "),a("p",[s._v("如果我们没有安装对应版本的 Node ，执行时也会提示没有安装")]),s._v(" "),a("h2",{attrs:{id:"资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[s._v("#")]),s._v(" 资料")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://mp.weixin.qq.com/s/i8Hh0nUp3J7MXJ-zl-57Ng",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);