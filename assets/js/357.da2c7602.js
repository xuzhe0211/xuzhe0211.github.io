(window.webpackJsonp=window.webpackJsonp||[]).push([[357],{1883:function(t,s,a){t.exports=a.p+"assets/img/20210202001408190.62b0d1e7.png"},2819:function(t,s,a){"use strict";a.r(s);var e=a(46),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("p",[t._v("react hook面试已经有一段时间了，相信很多人都已经在代码中用上hooks。而对于useEffect和useLayoutEffect,我们使用的最多的应该就是useEffect。那么他们两个到底有什么不一样的地方？")]),t._v(" "),e("h2",{attrs:{id:"使用方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用方式"}},[t._v("#")]),t._v(" 使用方式")]),t._v(" "),e("p",[t._v("这两个函数的使用方式其实非常简单，它们都接受一个函数一个数组，只有在数组里面的值改变的情况下才会再次执行effect。所以对于使用方式我就不过多介绍了，具体查看"),e("a",{attrs:{href:"https://zh-hans.reactjs.org/docs/hooks-reference.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("官网"),e("OutboundLink")],1)]),t._v(" "),e("h2",{attrs:{id:"差异"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#差异"}},[t._v("#")]),t._v(" 差异")]),t._v(" "),e("ul",[e("li",[e("p",[e("span",{staticStyle:{color:"blue"}},[t._v("useEffect(渲染后)是异步执行的，而useLayoutEffect(渲染时)是同步执行的")])])]),t._v(" "),e("li",[e("p",[e("span",{staticStyle:{color:"blue"}},[t._v("useEffect的执行时机是浏览器完成渲染之后，而useLayoutEffect的执行时机是浏览器把内容真正渲染到界面之前，和componentDidMount等价")])])]),t._v(" "),e("li",[e("p",[e("span",{staticStyle:{color:"blue"}},[t._v("useInsertionEffect(渲染前)工作原理类似useLayoutEffect,区别在于回调执行时还不能访问ref中的DOM节点。")])]),t._v(" "),e("ul",[e("li",[t._v("你可以在这个Hook内操作全局DOM节点(比如<style>或者SVG<defs>)")]),t._v(" "),e("li",[t._v("操作CSS库(比如CSS-IN-js方案)可以用这个Hook插入全局style")])])])]),t._v(" "),e("h2",{attrs:{id:"具体表现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#具体表现"}},[t._v("#")]),t._v(" 具体表现")]),t._v(" "),e("p",[t._v("🌰")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" React "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" useEffect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" useLayoutEffect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" useState "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" logo "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./logo.svg'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./App.css'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("App")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("state"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" setState"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("useState")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello world'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("useEffect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000000")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            i"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("setState")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'world hello'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// useLayoutEffect(() => {")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     let i = 0; ")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     while(i < 1000000) {")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//         i++;")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     }")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//     setState('world hello');")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// }, [])")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n            "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("div"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("state"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("div"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("这是它的效果\n"),e("img",{attrs:{src:a(1883),alt:"效果"}})]),t._v(" "),e("p",[e("span",{staticStyle:{color:"red"}},[t._v('"而换成useLayoutEffect之后闪烁现象就消失了')])]),t._v(" "),e("p",[t._v("看到这里相信你应该能理解他们的区别了，因为useEffect是渲染之后异步执行的，所以会导致hello world先被渲染到屏幕上，在变成world hello，就会出现闪烁现象。而useLayoutEffect是渲染之前同步执行的，所以会等它执行完在渲染上去，就避免了闪烁现象。也就是说等它执行完在渲染上去，就避免了闪烁现象。也就是说我们把操作dom的相关操作放到useLayoutEffect中去，避免导致闪烁")]),t._v(" "),e("h2",{attrs:{id:"ssr"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ssr"}},[t._v("#")]),t._v(" ssr")]),t._v(" "),e("p",[t._v("也正是因为useLayoutEffect可能会导致渲染结果不一样的关系，如果你在ssr的时候使用这个函数会有一个warning")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("Warning"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" useLayoutEffect does nothing on the server"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" because its effect cannot be encoded into the server renderer's output format"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" This will lead to a mismatch between the initial"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" non"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("hydrated "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UI")]),t._v(" and the intended "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UI")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" To avoid "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" useLayoutEffect should only be used "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" components that render exclusively on the client"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" See https"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("fb"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("me"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("react"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("uselayouteffect"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ssr "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" common fixes"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),e("p",[t._v("这是因为useLayoutEffect是不会在服务端，所以就有可能导致ssr渲染出来的内容和实际的首屏内容并不一致。而解决这个问题也很简单")]),t._v(" "),e("ul",[e("li",[t._v("放弃使用useLayoutEffect,使用useEffect代替")]),t._v(" "),e("li",[e("span",{staticStyle:{color:"blue"}},[t._v("如果你明确知道useLayoutEffect对于首屏渲染并没有影响，但是后续会使用，你可以这么写")])])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" useEffect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" useLayoutEffect "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" useCustomLayoutEffect "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" window "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'undefined'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" useLayoutEffect "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" useEffect"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("当你使用useLayoutEffect的时候就用useCustomLayoutEffect代替。这样在服务端就会用useEffect,这样就不回报warning了.")]),t._v(" "),e("h2",{attrs:{id:"源码剖析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#源码剖析"}},[t._v("#")]),t._v(" 源码剖析")]),t._v(" "),e("h3",{attrs:{id:"useeffect"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#useeffect"}},[t._v("#")]),t._v(" useEffect")]),t._v(" "),e("p",[t._v("首先找到useEffect调用入口")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateEffect")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("create"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" deps")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// $FlowExpectedError - jest isn't a global, and isn't recognized outside of tests")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'undefined'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" jest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("warnIfNotCurrentlyActingEffectsInDEV")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentlyRenderingFiber$"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("updateEffectImpl")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Update "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Passive"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Passive$"),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" create"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" deps"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("//................................................................")]),t._v(" "),e("h2",{attrs:{id:"总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),e("ul",[e("li",[e("span",{staticStyle:{color:"blue"}},[t._v("优先使用useEffect,因为它是异步的，不会阻塞渲染")])]),t._v(" "),e("li",[e("span",{staticStyle:{color:"blue"}},[t._v("会影响到渲染的操作尽量放到useLayoutEffect中去，避免出现闪烁问题")])]),t._v(" "),e("li",[e("span",{staticStyle:{color:"blue"}},[t._v("useLayoutEffect和componentDidMount是等价的，会同步调用，阻塞渲染")])]),t._v(" "),e("li",[e("span",{staticStyle:{color:"blue"}},[t._v("useLayoutEffect在服务端渲染的时候使用会有一个warning,因为它可能导致首屏实际内容和服务端渲染出来的内容不一样")])])]),t._v(" "),e("h2",{attrs:{id:"资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[t._v("#")]),t._v(" 资料")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://blog.csdn.net/qq_38164763/article/details/113532855",target:"_blank",rel:"noopener noreferrer"}},[t._v("useEffect和useLayoutEffect的区别"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/346977585",target:"_blank",rel:"noopener noreferrer"}},[t._v("梳理useEffect和useLayoutEffect的原理与区别"),e("OutboundLink")],1)]),t._v(" "),e("p",[e("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/388636591",target:"_blank",rel:"noopener noreferrer"}},[t._v("react杂谈之componentDidMount ----重要"),e("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);