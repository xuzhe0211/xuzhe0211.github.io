(window.webpackJsonp=window.webpackJsonp||[]).push([[389],{2175:function(s,a,t){"use strict";t.r(a);var e=t(46),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("p",[s._v("在使用Docker部署平台时，主要流程包括从构建容器镜像到在不同环境中运行容器。以下是一个标准的Docker部署平台流程，从创建镜像、配置、部署到容器化服务的持续集成与持续部署")]),s._v(" "),t("h2",{attrs:{id:"_1-准备环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-准备环境"}},[s._v("#")]),s._v(" 1. 准备环境")]),s._v(" "),t("ul",[t("li",[s._v("安装docker：确保目标机器或虚拟机安装了docker")]),s._v(" "),t("li",[s._v("安装docker-compose：docker-compose允许你定义和管理多容器应用程序")])]),s._v(" "),t("h2",{attrs:{id:"_2-构建docker镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-构建docker镜像"}},[s._v("#")]),s._v(" 2. 构建docker镜像")]),s._v(" "),t("h3",{attrs:{id:"_1-创建dockerfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建dockerfile"}},[s._v("#")]),s._v(" 1. 创建dockerfile")]),s._v(" "),t("p",[s._v("dockerfile是定义镜像的配置文件，包含从基础镜像开始，安装依赖，复制代码，执行命令等指令。")]),s._v(" "),t("p",[s._v("示例 Dockerfile(针对Node.js项目)")]),s._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用官方的 Node.js 镜像作为基础镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" node:16")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置工作目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WORKDIR")]),s._v(" /app")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制项目的 package.json 和 package-lock.json")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" package*.json ./")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装项目依赖")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("RUN")]),s._v(" npm install")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 复制源代码")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" . .")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露应用端口")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPOSE")]),s._v(" 3000")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动应用")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token instruction"}},[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" ["),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start"')]),s._v("]")]),s._v("\n")])])]),t("h3",{attrs:{id:"_2-构建docker镜像-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-构建docker镜像-2"}},[s._v("#")]),s._v(" 2. 构建docker镜像")]),s._v(" "),t("p",[s._v("在项目根目录运行以下命令来构建Docker镜像")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker build -t my-app "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])])]),t("p",[s._v("-t my-app指定镜像名称")]),s._v(" "),t("h3",{attrs:{id:"_3-查看镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-查看镜像"}},[s._v("#")]),s._v(" 3. 查看镜像")]),s._v(" "),t("p",[s._v("构建完成后，你可以查看本地镜像")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker images\n")])])]),t("h2",{attrs:{id:"_3-配置docker-compose-可选"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置docker-compose-可选"}},[s._v("#")]),s._v(" 3. 配置docker-compose(可选)")]),s._v(" "),t("p",[s._v("如果你的平台是一个多容器应用(如前后端分离、数据库服务等)，你可以使用 Docker Compose 来定义服务")]),s._v(" "),t("h3",{attrs:{id:"_1-创建docker-compose-yml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建docker-compose-yml"}},[s._v("#")]),s._v(" 1. 创建docker-compose.yml")]),s._v(" "),t("p",[s._v("示例: 定义一个Node.js应用和一个MongoDB服务")]),s._v(" "),t("div",{staticClass:"language-yml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("web")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3000:3000"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" NODE_ENV=production\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("db")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mongo\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"27017:27017"')]),s._v("\n")])])]),t("h3",{attrs:{id:"_2-启动docker-compose"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动docker-compose"}},[s._v("#")]),s._v(" 2. 启动Docker Compose")]),s._v(" "),t("p",[s._v("使用Docker Compose 启动服务")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker-compose up -d\n")])])]),t("p",[s._v("-d 选项让容器在后台运行")]),s._v(" "),t("h3",{attrs:{id:"_3-查看正在运行的容器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-查看正在运行的容器"}},[s._v("#")]),s._v(" 3. 查看正在运行的容器")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker-compose "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n")])])]),t("h2",{attrs:{id:"_4-将镜像推送到docker镜像仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-将镜像推送到docker镜像仓库"}},[s._v("#")]),s._v(" 4. 将镜像推送到Docker镜像仓库")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("登录Docker仓库\n如果你使用Docker Hub，首先需要登录")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("docker login\n")])])])]),s._v(" "),t("li",[t("p",[s._v("标记镜像\n使用仓库名标记镜像")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("docker tag my"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("my"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app\n")])])])]),s._v(" "),t("li",[t("p",[s._v("推送镜像")]),s._v(" "),t("p",[s._v("将镜像推送到docker Hub(或其他Docker 镜像仓库)")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker push username/my-app:latest\n")])])])])]),s._v(" "),t("h2",{attrs:{id:"_5-在目标环境部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-在目标环境部署"}},[s._v("#")]),s._v(" 5. 在目标环境部署")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("在服务器上拉取镜像")]),s._v(" "),t("p",[s._v("在目标服务器(或云平台，如AWS、GCP等)上拉取镜像")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker pull username/my-app:latest\n")])])])]),s._v(" "),t("li",[t("p",[s._v("运行容器")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker run -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(":3000 username/my-app:latest\n")])])])]),s._v(" "),t("li",[t("p",[s._v("查看容器日志")]),s._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker logs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("container_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])])])]),s._v(" "),t("h2",{attrs:{id:"_6-配置持久化存储-可选"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-配置持久化存储-可选"}},[s._v("#")]),s._v(" 6. 配置持久化存储(可选)")]),s._v(" "),t("p",[s._v("如果应用需要持久化数据(例如数据库)，可以使用docker Volumes来挂载目标主机上的目录")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v("docker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("path"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("to"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("my"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("latest\n")])])]),t("p",[s._v("或者在 docker-compose.yml 配置")]),s._v(" "),t("div",{staticClass:"language-yml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("db")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mongo\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /path/to/local/data"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/data/db\n")])])]),t("h2",{attrs:{id:"_7-部署到生产环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-部署到生产环境"}},[s._v("#")]),s._v(" 7. 部署到生产环境")]),s._v(" "),t("p",[s._v("将Docker镜像和配置推送到生产环境，常见的生产环境部署平台有")]),s._v(" "),t("ul",[t("li",[s._v("Docker Swarm: Docker自带的集群管理和编排工具")]),s._v(" "),t("li",[s._v("Kubernetes:更强大的编排平台")]),s._v(" "),t("li",[s._v("云服务平台：如 AWS ECS、Azure Container Instances、Google Kubernetes Engine 等。")])]),s._v(" "),t("h2",{attrs:{id:"配置cicd流水线"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置cicd流水线"}},[s._v("#")]),s._v(" 配置CICD流水线")]),s._v(" "),t("p",[s._v("为了自动化部署，可以使用 CI/CD 工具（如 Jenkins、GitLab CI、GitHub Actions）来自动化构建、测试和部署过程。")]),s._v(" "),t("ol",[t("li",[s._v("配置GitLab CI(示例)\n在项目根目录创建.gitlab-ci.yml文件"),t("div",{staticClass:"language-yml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" deploy\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker build "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("t my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app .\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker tag my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app registry.example.com/my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker push registry.example.com/my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deploy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deploy\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker pull registry.example.com/my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" docker run "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("p 3000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("3000 registry.example.com/my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n")])])])]),s._v(" "),t("li",[s._v("配置 GitHub Actions\n使用 .github/workflows/docker.yml 文件："),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("name: Docker Image CI\n\non:\npush:\n    branches:\n    - main\n\njobs:\nbuild:\n    runs-on: ubuntu-latest\n\n    steps:\n    - uses: actions/checkout@v2\n    - name: Build Docker image\n        run: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n        docker build -t my-app "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n        docker tag my-app ghcr.io/username/my-app:latest\n    - name: Push to GitHub Container Registry\n        run: "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${{ secrets.GITHUB_TOKEN }")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" docker login ghcr.io -u "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${{ github.actor }")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" --password-stdin\n        docker push ghcr.io/username/my-app:latest\n")])])])])]),s._v(" "),t("h2",{attrs:{id:"监控与日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#监控与日志"}},[s._v("#")]),s._v(" 监控与日志")]),s._v(" "),t("p",[s._v("为了确保平台的稳定运行，部署后你需要监控应用的运行状况，并且查看容器日志")]),s._v(" "),t("ol",[t("li",[s._v("容器日志查看"),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("docker logs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("container_id"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])])])]),s._v(" "),t("li",[s._v("监控容器资源\n使用docker stats查看容器的资源使用情况"),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("docker stats\n")])])])]),s._v(" "),t("li",[s._v("集成监控工具\n可以使用 Prometheus + Grafana 等工具来监控 Docker 容器的健康和性能。")])])])}),[],!1,null,null,null);a.default=r.exports}}]);