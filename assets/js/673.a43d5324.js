(window.webpackJsonp=window.webpackJsonp||[]).push([[673],{2693:function(t,s,a){"use strict";a.r(s);var n=a(46),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"å®ç°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®ç°"}},[t._v("#")]),t._v(" å®ç°")]),t._v(" "),a("ol",[a("li",[t._v("åˆ©ç”¨iframeåˆ›å»ºæ²™ç®±ï¼Œå–å‡ºå…¶ä¸­çš„åŸç”Ÿæµè§ˆå™¨å…¨å±€å¯¹è±¡ä½œä¸ºæ²™ç®±çš„å…¨å±€å¯¹è±¡")]),t._v(" "),a("li",[t._v("è®¾ç½®ä¸€ä¸ªé»‘åå•ï¼Œè‹¥è®¿é—®é»‘åå•ä¸­çš„å˜é‡ï¼Œåˆ™ç›´æ¥æŠ¥é”™ï¼Œå®ç°é˜»æ­¢/éš”ç¦»çš„æ•ˆæœ")]),t._v(" "),a("li",[t._v("åœ¨é»‘åå•ä¸­æ·»åŠ documentå­—æ®µï¼Œæ¥å®ç°ç¦æ­¢å¼€å‘è€…æ“ä½œDOM")]),t._v(" "),a("li",[t._v("åœ¨é»‘åå•ä¸­æ·»åŠ XMLHttpRequestã€fetchã€websocketå­—æ®µï¼Œå®ç°ç¦ç”¨åŸç”Ÿçš„æ–¹å¼è°ƒç”¨æ¥å£")]),t._v(" "),a("li",[t._v("è‹¥è®¿é—®å½“å‰å…¨å±€å¯¹è±¡ä¸­ä¸å­˜åœ¨å˜é‡ï¼Œåˆ™ç›´æ¥æŠ¥é”™ï¼Œå®ç°ç¦ç”¨ç¬¬ä¸‰æ–¹åº“è°ƒç”¨")]),t._v(" "),a("li",[t._v("æœ€åè¿˜è¦æ‹¦æˆªå¯¹windowå¯¹è±¡çš„è®¿é—®ï¼Œé˜²æ­¢é€šè¿‡window.documentæ¥æ“ä½œDOMï¼Œé¿å…æ²™ç®±é€ƒé€¸")])]),t._v(" "),a("h2",{attrs:{id:"å¦‚ä½•ç¦æ­¢å¼€å‘è€…æ“ä½œdom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ç¦æ­¢å¼€å‘è€…æ“ä½œdom"}},[t._v("#")]),t._v(" å¦‚ä½•ç¦æ­¢å¼€å‘è€…æ“ä½œDOM")]),t._v(" "),a("p",[t._v("åœ¨é¡µé¢ä¸­ï¼Œå¯ä»¥é€šè¿‡documentå¯¹è±¡æ¥è·å–HTMLå…ƒç´ ï¼Œè¿›è¡Œå¢åˆ æ”¹æŸ¥çš„DOMæ“ä½œ")]),t._v(" "),a("p",[t._v("å¦‚ä½•ç¦æ­¢å¼€å‘è€…æ“ä½œDOMï¼Œè½¬åŒ–ä¸ºå¦‚ä½•ç»„ç»‡å¼€å‘è€…è·å–documentå¯¹è±¡")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("ä¼ ç»Ÿæ€è·¯")]),t._v(" "),a("p",[t._v("ç®€å•ç²—æš´ç‚¹ï¼Œç›´æ¥ä¿®æ”¹window.documentçš„å€¼ï¼Œè®©å¼€å‘è€…æ— æ³•è·å–document")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°†documentè®¾ç½®ä¸ºnull")]),t._v("\nwindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è®¾ç½®æ— æ•ˆï¼Œæ‰“å°ç»“æœè¿˜æ˜¯document")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ é™¤document")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("delete")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ é™¤æ— æ•ˆï¼Œæ‰“å°ç»“æœè¿˜æ˜¯document")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("å¥½å§ï¼Œdocument ä¿®æ”¹ä¸äº†ä¹Ÿåˆ é™¤ä¸äº†ğŸ¤”")]),t._v(" "),a("p",[t._v("ä½¿ç”¨ Object.getOwnPropertyDescriptor æŸ¥çœ‹ï¼Œä¼šå‘ç° window.document çš„ configurable å±æ€§ä¸º falseï¼ˆä¸å¯é…ç½®çš„ï¼‰")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOwnPropertyDescriptor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'document'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// {get: Æ’, set: undefined, enumerable: true, configurable: false}")]),t._v("\n")])])]),a("p",[t._v("configurableå†³å®šäº†æ˜¯å¦å¯ä»¥ä¿®æ”¹å±æ€§æè¿°å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œconfigurableä¸ºfalseæ—¶ï¼Œvalueã€writableã€enumberableå’Œconfigurableéƒ½ä¸èƒ½è¢«ä¿®æ”¹ï¼Œä»¥åŠæ— æ³•è¢«åˆ é™¤")]),t._v(" "),a("p",[a("strong",[t._v("æ­¤è·¯ä¸é€šï¼Œæ¨åˆ°é‡æ¥")])])]),t._v(" "),a("li",[a("p",[t._v("æœ‰ç‚¹é«˜å¤§ä¸Šæ€è·¯")]),t._v(" "),a("p",[t._v("æ—¢ç„¶documentå¯¹è±¡ä¿®æ”¹ä¸äº†ï¼Œé‚£å¦‚æœç¯å¢ƒä¸­åŸæœ¬å°±æ²¡æœ‰documentå¯¹è±¡ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥å®ç°éœ€æ±‚ï¼Ÿ")]),t._v(" "),a("p",[t._v("è¯´åˆ°ç¯å¢ƒä¸­æ²¡æœ‰ document å¯¹è±¡ï¼ŒWeb Worker ç›´å‘¼å†…è¡Œï¼Œæˆ‘æ›¾åœ¨"),a("a",{attrs:{href:"https://juejin.cn/post/7137728629986820126",target:"_blank",rel:"noopener noreferrer"}},[t._v("ã€Šä¸€æ–‡å½»åº•äº†è§£Web Workerï¼Œåä¸‡ã€ç™¾ä¸‡æ¡æ•°æ®éƒ½æ˜¯å¼Ÿå¼ŸğŸ”¥ã€‹"),a("OutboundLink")],1),t._v("ä¸­èŠè¿‡å¦‚ä½•ä½¿ç”¨ Web Workerï¼Œå’Œå¯¹åº”çš„ç‰¹æ€§")]),t._v(" "),a("p",[t._v("å¹¶ä¸” Web Worker æ›´ç‹ ï¼Œä¸ä½†æ²¡æœ‰ document å¯¹è±¡ï¼Œè¿ window å¯¹è±¡ä¹Ÿæ²¡æœ‰ğŸ˜‚")]),t._v(" "),a("p",[t._v("åœ¨workerçº¿ç¨‹ä¸­æ‰“å°window")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmessage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("postMessage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("æµè§ˆå™¨ç›´æ¥æŠ¥é”™")]),t._v(" "),a("p",[t._v("åœ¨ Web Worker çº¿ç¨‹çš„è¿è¡Œç¯å¢ƒä¸­æ— æ³•è®¿é—® document å¯¹è±¡ï¼Œè¿™ä¸€æ¡ç¬¦åˆå½“å‰çš„éœ€æ±‚ï¼Œä½†æ˜¯è¯¥ç¯å¢ƒä¸­èƒ½è·å– XMLHttpRequest å¯¹è±¡ï¼Œå¯ä»¥å‘é€ ajax è¯·æ±‚ï¼Œä¸ç¬¦åˆä¸èƒ½è°ƒæ¥å£çš„è¦æ±‚")]),t._v(" "),a("p",[a("strong",[t._v("æ­¤è·¯è¿˜æ˜¯ä¸é€šâ€¦â€¦ğŸ˜“")])])])]),t._v(" "),a("h2",{attrs:{id:"å¦‚ä½•ç¦æ­¢å¼€å‘è€…è°ƒç”¨æ¥å£"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ç¦æ­¢å¼€å‘è€…è°ƒç”¨æ¥å£"}},[t._v("#")]),t._v(" å¦‚ä½•ç¦æ­¢å¼€å‘è€…è°ƒç”¨æ¥å£")]),t._v(" "),a("p",[t._v("å¸¸è§„è°ƒæ¥å£æ–¹å¼æœ‰ï¼š")]),t._v(" "),a("ol",[a("li",[t._v("åŸç”Ÿæ–¹å¼ï¼šXMLHttpRequestã€fetchã€WebSocketã€jsonpã€formè¡¨å•")]),t._v(" "),a("li",[t._v("ä¸‰æ–¹å®ç°ï¼šaxiosã€jqueryã€requestç­‰ä¼—å¤šå¼€æºåº“")])]),t._v(" "),a("p",[t._v("ç¦ç”¨åŸç”Ÿæ–¹å¼è°ƒæ¥å£çš„æ€è·¯ï¼š")]),t._v(" "),a("ol",[a("li",[t._v("XMLHttpRequestã€fetchã€WebSocket è¿™å‡ ç§æƒ…å†µï¼Œå¯ä»¥ç¦æ­¢ç”¨æˆ·è®¿é—®è¿™äº›å¯¹è±¡")]),t._v(" "),a("li",[t._v("jsonpã€form è¿™ä¸¤ç§æ–¹å¼ï¼Œéœ€è¦åˆ›å»ºscriptæˆ–formæ ‡ç­¾ï¼Œä¾ç„¶å¯ä»¥é€šè¿‡ç¦æ­¢å¼€å‘è€…æ“ä½œDOMçš„æ–¹å¼è§£å†³ï¼Œä¸éœ€è¦å•ç‹¬å¤„ç†")])]),t._v(" "),a("p",[t._v("å¦‚ä½•ç¦ç”¨ä¸‰æ–¹åº“è°ƒæ¥å£å‘¢ï¼Ÿ")]),t._v(" "),a("p",[t._v("ä¸‰æ–¹åº“å¾ˆå¤šï¼Œæ²¡åŠæ³•å…¨éƒ¨åˆ—å‡ºæ¥ï¼Œæ¥è¿›è¡Œé€ä¸€æ’é™¤")]),t._v(" "),a("p",[t._v("ç¦æ­¢è°ƒæ¥å£çš„è·¯å¥½åƒä¹Ÿè¢«å°æ­»äº†â€¦â€¦ğŸ˜°")]),t._v(" "),a("h2",{attrs:{id:"æœ€ç»ˆæ–¹æ¡ˆ-æ²™ç®±-sandbox"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æœ€ç»ˆæ–¹æ¡ˆ-æ²™ç®±-sandbox"}},[t._v("#")]),t._v(" æœ€ç»ˆæ–¹æ¡ˆï¼šæ²™ç®±(sandbox)")]),t._v(" "),a("p",[a("span",{staticStyle:{color:"red"}},[t._v("**æ²™ç®±(Sandbox)**æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œä¸ºè¿è¡Œä¸­çš„ç¨‹åºæä¾›éš”ç¦»ç¯å¢ƒï¼Œå®ƒä¼šä¸ºå¾…æ‰§è¡Œçš„ç¨‹åºåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„æ‰§è¡Œç¯å¢ƒï¼Œå†…éƒ¨ç¨‹åºçš„æ‰§è¡Œä¸ä¼šå½±å“åˆ°å¤–éƒ¨ç¨‹åºçš„è¿è¡Œ")])]),t._v(" "),a("p",[t._v("å‰ç«¯æ²™ç®±çš„ä½¿ç”¨åœºæ™¯ï¼š")]),t._v(" "),a("ol",[a("li",[t._v("Chrome æµè§ˆå™¨æ‰“å¼€çš„æ¯ä¸ªé¡µé¢å°±æ˜¯ä¸€ä¸ªæ²™ç®±ï¼Œä¿è¯å½¼æ­¤ç‹¬ç«‹äº’ä¸å½±å“")]),t._v(" "),a("li",[t._v("æ‰§è¡Œ jsonp è¯·æ±‚å›æ¥çš„å­—ç¬¦ä¸²æ—¶æˆ–å¼•å…¥ä¸çŸ¥åç¬¬ä¸‰æ–¹ JS åº“æ—¶ï¼Œå¯èƒ½éœ€è¦åˆ›é€ ä¸€ä¸ªæ²™ç®±æ¥æ‰§è¡Œè¿™äº›ä»£ç ")]),t._v(" "),a("li",[t._v("Vue æ¨¡æ¿è¡¨è¾¾å¼çš„è®¡ç®—æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªæ²™ç®±ä¸­ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²ä¸­çš„è¡¨è¾¾å¼åªèƒ½è·å–éƒ¨åˆ†å…¨å±€å¯¹è±¡ï¼Œè¯¦æƒ…è§æºç ")]),t._v(" "),a("li",[t._v("å¾®å‰ç«¯æ¡†æ¶ qiankun ï¼Œä¸ºäº†å®ç°jséš”ç¦»ï¼Œåœ¨å¤šç§åœºæ™¯ä¸‹å‡ä½¿ç”¨äº†æ²™ç®±")])]),t._v(" "),a("h2",{attrs:{id:"æ²™ç®±çš„å¤šç§å®ç°æ–¹å¼"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ²™ç®±çš„å¤šç§å®ç°æ–¹å¼"}},[t._v("#")]),t._v(" æ²™ç®±çš„å¤šç§å®ç°æ–¹å¼")]),t._v(" "),a("p",[t._v("å…ˆèŠä¸‹"),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/with",target:"_blank",rel:"noopener noreferrer"}},[t._v("with"),a("OutboundLink")],1),t._v("å…³é”®å­—:ä½œç”¨åœ¨äºæ”¹å˜ä½œç”¨åŸŸï¼Œå¯ä»¥å°†æŸä¸ªå¯¹è±¡æ·»åŠ åˆ°ä½œç”¨åŸŸé“¾çš„é¡¶éƒ¨")]),t._v(" "),a("p",[a("strong",[t._v("withå¯¹äºæ²™ç®±çš„æ„ä¹‰:å¯ä»¥äº‹å…ˆæ‰€æœ‰å˜é‡å‡æ¥è‡ªå¯é æˆ–è‡ªä¸»å®ç°çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œè€Œä¸ä¼šä»å…¨å±€çš„æ‰§è¡Œç¯å¢ƒä¸­å–å€¼ï¼Œç›¸å½“äºåšäº†ä¸€å±‚æ‹¦æˆªï¼Œå®ç°éš”ç¦»çš„æ•ˆæœ")])]),t._v(" "),a("h3",{attrs:{id:"ç®€é™‹çš„æ²™ç®±"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç®€é™‹çš„æ²™ç®±"}},[t._v("#")]),t._v(" ç®€é™‹çš„æ²™ç®±")]),t._v(" "),a("p",[t._v("å®ç°è¿™æ ·ä¸€ä¸ªæ²™ç®±ï¼Œè¦æ±‚ç¨‹åºä¸­è®¿é—®çš„æ‰€æœ‰å˜é‡ï¼Œå‡æ¥è‡ªå¯é æˆ–è‡ªä¸»å®ç°çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œè€Œä¸ä¼šä»å…¨å±€çš„æ‰§è¡Œç¯å¢ƒä¸­å–å€¼")]),t._v(" "),a("p",[t._v("ä¸¾ä¾‹å­:ctxä½œä¸ºæ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¾…æ‰§è¡Œç¨‹åºcodeå¯ä»¥è®¿é—®åˆ°çš„å˜é‡ï¼Œå¿…é¡»éƒ½æ¥è‡ªä¸ctxå¯¹è±¡")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ctxæ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ctx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("variable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("variable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" \n    foo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'f1'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¾…æ‰§è¡Œç¨‹åº")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("func(foo)")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n")])])]),a("p",[t._v("æ²™ç®±å®ä¾‹")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å®šä¹‰å…¨å±€å˜é‡foo")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" foo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'foo1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ctx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("variable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("variable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    foo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'f1'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// éå¸¸ç®€é™‹çš„æ²™ç®±")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("veryPoorSandbox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä½¿ç”¨with,å°†evalå‡½æ•°æ‰§è¡Œæ—¶çš„æ‰§è¡Œä¸Šä¸‹æ–‡æŒ‡å®šä¸ºctx")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("eval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("func(foo)")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("veryPoorSandbox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// æ‰“å°ç»“æœï¼š"f1"ï¼Œä¸æ˜¯æœ€å¤–å±‚çš„å…¨å±€å˜é‡"foo1"')]),t._v("\n")])])]),a("p",[t._v("è¿™ä¸ªæ²™ç®±æœ‰ä¸€ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼Œè‹¥æä¾›çš„ctxä¸Šä¸‹æ–‡å¯¹è±¡ä¸­ï¼Œæ²¡æœ‰æ‰¾åˆ°æŸä¸ªå˜é‡æ—¶ï¼Œä»£ç ä»ä¼šæ²¿ç€ä½œç”¨åŸŸé“¾ä¸€å±‚å±‚å‘ä¸ŠæŸ¥æ‰¾")]),t._v(" "),a("p",[t._v("å‡å¦‚ä¸Šæ–‡ç¤ºä¾‹ä¸­çš„ ctx å¯¹è±¡æ²¡æœ‰è®¾ç½® fooå±æ€§ï¼Œæ‰“å°çš„ç»“æœè¿˜æ˜¯å¤–å±‚ä½œç”¨åŸŸçš„foo1")]),t._v(" "),a("h3",{attrs:{id:"with-proxyå®ç°æ²™ç®±"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#with-proxyå®ç°æ²™ç®±"}},[t._v("#")]),t._v(" with+proxyå®ç°æ²™ç®±")]),t._v(" "),a("p",[t._v("å¸Œæœ›æ²™ç®±ä¸­çš„ä»£ç åªåœ¨æ‰‹åŠ¨æä¾›çš„ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­æŸ¥æ‰¾å˜é‡ï¼Œå¦‚æœä¸Šä¸‹æ–‡å¯¹è±¡ä¸­ä¸å­˜åœ¨è¯¥å˜é‡ï¼Œåˆ™æç¤ºé”™è¯¯")]),t._v(" "),a("p",[t._v("ğŸŒ°ï¼šctxä½œä¸ºæ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå¾…æ‰§è¡Œç¨‹åºcodeå¯ä»¥è®¿é—®åˆ°çš„å˜é‡ï¼Œå¿…é¡»éƒ½æ¥è‡ªäºctxå¯¹è±¡ï¼Œå¦‚æœctxå¯¹è±¡ä¸­ä¸å­˜åœ¨è¯¥å˜é‡ï¼Œç›´æ¥æŠ¥é”™ï¼Œä¸åœ¨é€šè¿‡ä½œç”¨åŸŸå‘ä¸ŠæŸ¥æ‰¾")]),t._v(" "),a("p",[t._v("å®ç°æ­¥éª¤")]),t._v(" "),a("ol",[a("li",[t._v("ä½¿ç”¨Proxy.has()æ¥æ‹¦æˆªwithä»£ç å—ä¸­çš„ä»»æ„å˜é‡çš„è®¿é—®")]),t._v(" "),a("li",[t._v("è®¾ç½®ä¸€ä¸ªç™½åå•ï¼Œåœ¨ç™½åå•å†…çš„å˜é‡å¯ä»¥æ­£å¸¸èµ°ä½œç”¨åŸŸé“¾çš„è®¿é—®æ–¹å¼ï¼Œä¸åœ¨ç™½åå•å†…çš„å˜é‡ï¼Œä¼šç»§ç»­åˆ¤æ–­æ˜¯å¦å­˜ ctx å¯¹è±¡ä¸­ï¼Œå­˜åœ¨åˆ™æ­£å¸¸è®¿é—®ï¼Œä¸å­˜åœ¨åˆ™ç›´æ¥æŠ¥é”™")]),t._v(" "),a("li",[t._v("ä½¿ç”¨new Functionæ›¿ä»£evalï¼Œä½¿ç”¨ new Function() è¿è¡Œä»£ç æ¯”evalæ›´ä¸ºå¥½ä¸€äº›ï¼Œå‡½æ•°çš„å‚æ•°æä¾›äº†æ¸…æ™°çš„æ¥å£æ¥è¿è¡Œä»£ç ")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/db7ec7b51933",target:"_blank",rel:"noopener noreferrer"}},[t._v("new Functionä¸evalçš„åŒºåˆ«"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" foo "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ctx "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("func")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("variable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("variable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ„é€ ä¸€ä¸ªwithæ¥åŒ…è£¹éœ€è¦æ‰§è¡Œçš„ä»£ç ï¼Œè¿”å›withä»£ç å—çš„ä¸€ä¸ªå‡½æ•°å®ä¾‹")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withedYourCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("code")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"width(shadow) {"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'shadow'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯è®¿é—®å…¨å±€ä½œç”¨åŸŸçš„ç™½åå•åˆ—è¡¨")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" access_white_list "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'func'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¾…æ‰§è¡Œç¨‹åº")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("func(foo)")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰§è¡Œä¸Šä¸‹æ–‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ctxProxy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Proxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("has")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// haså¯ä»¥æ‹¦æˆªwithä»£ç å—ä¸­ä»»æ„å±æ€§çš„è®¿é—®")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("access_white_list"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("includes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasOwnProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasOwnProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Erro")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Not found'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ²¡é‚£ä¹ˆç®€é™‹çš„æ²™ç®±")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("littlePoorSandbox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°† this æŒ‡å‘æ‰‹åŠ¨æ„é€ çš„å…¨å±€ä»£ç†å¯¹è±¡")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withedYourCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("littlePoorSandbox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctxProxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h3",{attrs:{id:"å¤©ç„¶ä¼˜è´¨æ²™ç®±"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¤©ç„¶ä¼˜è´¨æ²™ç®±"}},[t._v("#")]),t._v(" å¤©ç„¶ä¼˜è´¨æ²™ç®±")]),t._v(" "),a("p",[t._v("iframeÂ æ ‡ç­¾å¯ä»¥åˆ›é€ ä¸€ä¸ªç‹¬ç«‹çš„æµè§ˆå™¨åŸç”Ÿçº§åˆ«çš„è¿è¡Œç¯å¢ƒï¼Œè¿™ä¸ªç¯å¢ƒç”±æµè§ˆå™¨å®ç°äº†ä¸ä¸»ç¯å¢ƒçš„éš”ç¦»")]),t._v(" "),a("p",[t._v("åˆ©ç”¨ iframe æ¥å®ç°ä¸€ä¸ªæ²™ç®±æ˜¯ç›®å‰æœ€æ–¹ä¾¿ã€ç®€å•ã€å®‰å…¨çš„æ–¹æ³•ï¼Œå¯ä»¥æŠŠ iframe.contentWindow ä½œä¸ºæ²™ç®±æ‰§è¡Œçš„å…¨å±€ window å¯¹è±¡")]),t._v(" "),a("p",[t._v("æ²™ç®±ç¤ºä¾‹ï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ²™ç®±å…¨å±€ä»£ç†å¯¹è±¡ç±»")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SandboxGlobalProxy")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("sharedState")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºä¸€ä¸ª iframe æ ‡ç­¾ï¼Œå–å‡ºå…¶ä¸­çš„åŸç”Ÿæµè§ˆå™¨å…¨å±€å¯¹è±¡ä½œä¸ºæ²™ç®±çš„å…¨å±€å¯¹è±¡")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" iframe "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iframe"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"about:blank"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    iframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("display "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"none"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// sandboxGlobalä½œä¸ºæ²™ç®±è¿è¡Œæ—¶çš„å…¨å±€å¯¹è±¡")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sandboxGlobal "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" iframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Proxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandboxGlobal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("has")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// has å¯ä»¥æ‹¦æˆª with ä»£ç å—ä¸­ä»»æ„å±æ€§çš„è®¿é—®")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sharedState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("includes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœå±æ€§å­˜åœ¨äºå…±äº«çš„å…¨å±€çŠ¶æ€ä¸­ï¼Œåˆ™è®©å…¶æ²¿ç€åŸå‹é“¾åœ¨å¤–å±‚æŸ¥æ‰¾")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœæ²¡æœ‰è¯¥å±æ€§ï¼Œç›´æ¥æŠ¥é”™")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasOwnProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Not find: ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("prop"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å±æ€§å­˜åœ¨ï¼Œè¿”å›sandboxGlobalä¸­çš„å€¼")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ„é€ ä¸€ä¸ª with æ¥åŒ…è£¹éœ€è¦æ‰§è¡Œçš„ä»£ç ï¼Œè¿”å› with ä»£ç å—çš„ä¸€ä¸ªå‡½æ•°å®ä¾‹")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withedYourCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("code")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"with(sandbox) {"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sandbox"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("maybeAvailableSandbox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withedYourCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¦æ‰§è¡Œçš„ä»£ç ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\n  console.log(history == window.history) // false\n  window.abc = 'sandbox'\n  Object.prototype.toString = () => {\n      console.log('Traped!')\n  }\n  console.log(window.abc) // sandbox\n")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// sharedGlobalä½œä¸ºä¸å¤–éƒ¨æ‰§è¡Œç¯å¢ƒå…±äº«çš„å…¨å±€å¯¹è±¡")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// codeä¸­è·å–çš„historyä¸ºæœ€å¤–å±‚ä½œç”¨åŸŸçš„history")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sharedGlobal "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"history"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" globalProxy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SandboxGlobalProxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sharedGlobal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("maybeAvailableSandbox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" globalProxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯¹å¤–å±‚çš„windowå¯¹è±¡æ²¡æœ‰å½±å“")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("abc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// undefined")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¹¶æ²¡æœ‰æ‰“å° Traped")]),t._v("\n")])])]),a("p",[t._v("å¯ä»¥çœ‹åˆ°ï¼Œæ²™ç®±ä¸­å¯¹windowçš„æ‰€æœ‰æ“ä½œï¼Œéƒ½æ²¡æœ‰å½±å“åˆ°å¤–å±‚çš„windowï¼Œå®ç°äº†éš”ç¦»çš„æ•ˆæœğŸ˜˜")]),t._v(" "),a("h2",{attrs:{id:"æœ€ç»ˆå®ç°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æœ€ç»ˆå®ç°"}},[t._v("#")]),t._v(" æœ€ç»ˆå®ç°")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ²™ç®±å…¨å±€ä»£ç†å¯¹è±¡ç±»")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SandboxGlobalProxy")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("blacklist")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åˆ›å»ºä¸€ä¸ª iframe æ ‡ç­¾ï¼Œå–å‡ºå…¶ä¸­çš„åŸç”Ÿæµè§ˆå™¨å…¨å±€å¯¹è±¡ä½œä¸ºæ²™ç®±çš„å…¨å±€å¯¹è±¡")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" iframe "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"iframe"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"about:blank"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    iframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("display "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"none"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·å–å½“å‰HTMLIFrameElementçš„Windowå¯¹è±¡")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sandboxGlobal "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" iframe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("contentWindow"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Proxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sandboxGlobal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// has å¯ä»¥æ‹¦æˆª with ä»£ç å—ä¸­ä»»æ„å±æ€§çš„è®¿é—®")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("has")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" prop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é»‘åå•ä¸­çš„å˜é‡ç¦æ­¢è®¿é—®")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("blacklist"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("includes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Can't use: ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("prop"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// sandboxGlobalå¯¹è±¡ä¸Šä¸å­˜åœ¨çš„å±æ€§ï¼Œç›´æ¥æŠ¥é”™ï¼Œå®ç°ç¦ç”¨ä¸‰æ–¹åº“è°ƒæ¥å£")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasOwnProperty")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("prop"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("Not find: ")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("prop"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿”å›trueï¼Œè·å–å½“å‰æä¾›ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­çš„å˜é‡ï¼›å¦‚æœè¿”å›falseï¼Œä¼šç»§ç»­å‘ä¸Šå±‚ä½œç”¨åŸŸé“¾ä¸­æŸ¥æ‰¾")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä½¿ç”¨withå…³é”®å­—ï¼Œæ¥æ”¹å˜ä½œç”¨åŸŸ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withedYourCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("code")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"with(sandbox) {"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sandbox"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°†æŒ‡å®šçš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œæ·»åŠ åˆ°å¾…æ‰§è¡Œä»£ç ä½œç”¨åŸŸçš„é¡¶éƒ¨")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeSandbox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withedYourCode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¾…æ‰§è¡Œçš„ä»£ç codeï¼Œè·å–documentå¯¹è±¡")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" code "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("console.log(document)")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è®¾ç½®é»‘åå•")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç»è¿‡å°ä¼™ä¼´çš„æŒ‡å¯¼ï¼Œæ–°æ·»åŠ Imageå­—æ®µï¼Œç¦æ­¢ä½¿ç”¨new Imageæ¥è°ƒæ¥å£")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" blacklist "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'window'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'document'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'XMLHttpRequest'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fetch'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'WebSocket'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Image'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°†globalProxyå¯¹è±¡ï¼Œæ·»åŠ åˆ°æ–°ç¯å¢ƒä½œç”¨åŸŸé“¾çš„é¡¶éƒ¨")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" globalProxy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SandboxGlobalProxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("blacklist"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("makeSandbox")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" globalProxy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"æŒç»­ä¼˜åŒ–"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æŒç»­ä¼˜åŒ–"}},[t._v("#")]),t._v(" æŒç»­ä¼˜åŒ–")]),t._v(" "),a("p",[t._v("ç»è¿‡ä¸è¯„è®ºåŒºå°ä¼™ä¼´çš„äº¤æµï¼Œå¯ä»¥é€šè¿‡ new Image() è°ƒæ¥å£ï¼Œç¡®å®æ˜¯ä¸ªæ¼æ´")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¸éœ€è¦åˆ›å»ºDOM å‘é€å›¾ç‰‡è¯·æ±‚")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" img "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nimg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://www.test.com/img.gif"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("é»‘åå•ä¸­æ·»åŠ 'Image'å­—æ®µï¼Œå µä¸Šè¿™ä¸ªæ¼æ´ã€‚å¦‚æœè¿˜æœ‰å…¶ä»–æ¼æ´ï¼Œæ¬¢è¿äº¤æµè®¨è®ºğŸ’•")]),t._v(" "),a("h2",{attrs:{id:"èµ„æ–™"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#èµ„æ–™"}},[t._v("#")]),t._v(" èµ„æ–™")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/7157570429928865828",target:"_blank",rel:"noopener noreferrer"}},[t._v("é¢è¯•å®˜:è¯·è®¾è®¡ä¸€ä¸ªä¸èƒ½æ“ä½œDOMå’Œè°ƒæ¥å£çš„ç¯å¢ƒ"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);