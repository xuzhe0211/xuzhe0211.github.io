(window.webpackJsonp=window.webpackJsonp||[]).push([[383],{2156:function(e,a,t){"use strict";t.r(a);var s=t(46),r=Object(s.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h2",{attrs:{id:"介绍"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[e._v("#")]),e._v(" 介绍")]),e._v(" "),t("p",[e._v("关于Docker的一些笔记")]),e._v(" "),t("blockquote",[t("p",[e._v("Docker利用了Linux内核特性命名空间(namespace)及控制组(cgroups)等为容器提供隔离的运行环境")])]),e._v(" "),t("h2",{attrs:{id:"使用脚本快速启用docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用脚本快速启用docker"}},[e._v("#")]),e._v(" 使用脚本快速启用Docker")]),e._v(" "),t("p",[e._v("在过去常常手动安装，现在已经完全切换为脚本形式了")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("curl -fsSL https://get.docker.com -o get-docker.sh\n\nsudo sh get-docker.sh\n# 替换源\n# sudo sh get-docker.sh --mirror Aliyun\n# sudo sh get-docker.sh --mirror AzureChinaCloud\n")])])]),t("p",[e._v("如果担心脚本异常，可以下载并进行审核")]),e._v(" "),t("p",[e._v("接着就可以开始愉快的使用了，例行习惯Hello World:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('docker run hello-world\n\n# 输出\nHello from Docker!\nThis message shows that your installation appears to be working correctly.\n\nTo generate this message, Docker took the following steps:\n 1. The Docker client contacted the Docker daemon.\n 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.\n    (amd64)\n 3. The Docker daemon created a new container from that image which runs the\n    executable that produces the output you are currently reading.\n 4. The Docker daemon streamed that output to the Docker client, which sent it\n    to your terminal.\n\nTo try something more ambitious, you can run an Ubuntu container with:\n $ docker run -it ubuntu bash\n\nShare images, automate workflows, and more with a free Docker ID:\n https://hub.docker.com/\n\nFor more examples and ideas, visit:\n https://docs.docker.com/get-started/\n')])])]),t("h2",{attrs:{id:"初始化docker环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#初始化docker环境"}},[e._v("#")]),e._v(" 初始化Docker环境")]),e._v(" "),t("h3",{attrs:{id:"设置用户组"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置用户组"}},[e._v("#")]),e._v(" 设置用户组")]),e._v(" "),t("p",[e._v("为了避免每次使用Docker都需要切换到sudo，可以将docker加入当前用户，重新登录后生效")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("sudo groupadd docker\n\nsudo usermod -aG docker $USER\n#or\nsudo usermod -aG docker USER_NAME\n")])])]),t("h3",{attrs:{id:"镜像加速"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像加速"}},[e._v("#")]),e._v(" 镜像加速")]),e._v(" "),t("p",[e._v("镜像服务可用:")]),e._v(" "),t("ol",[t("li",[t("a",{attrs:{href:"https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors?accounttraceid=b7ab50df669847d08a7e5403de064166sqca",target:"_blank",rel:"noopener noreferrer"}},[e._v("阿里云镜像服务"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://sf.163.com/help/documents/56918246390157312",target:"_blank",rel:"noopener noreferrer"}},[e._v("网易云镜像服务"),t("OutboundLink")],1)])]),e._v(" "),t("p",[e._v("修改本地的/etc/docker/daemon.json并修改registry-mirrors, 可为其配置多个避免某个挂掉：")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('{\n    "registry-mirrors": [\n        "https://hub-mirror.c.163.com"\n    ]\n}\n')])])]),t("h3",{attrs:{id:"修改存储路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改存储路径"}},[e._v("#")]),e._v(" 修改存储路径")]),e._v(" "),t("p",[e._v("通过docker info 可以看到默认路径 /var/lib/docker, 而一般服务器会额外挂载硬盘。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('# 修改配置文件\nvim /etc/docker/daemon.json\n\n# 增加\n{\n    "data-root": "/path/to/docker"\n}\n\n# 重启docker\nsystemctl restart docker\n')])])]),t("p",[e._v("执行 docker info进行校验。")]),e._v(" "),t("h2",{attrs:{id:"热门镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#热门镜像"}},[e._v("#")]),e._v(" 热门镜像")]),e._v(" "),t("h3",{attrs:{id:"busybox"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#busybox"}},[e._v("#")]),e._v(" Busybox")]),e._v(" "),t("p",[e._v("以前常常会用ubuntu来测试一些命令行工具，现在有了更好的选择")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# --rm 用完即删\ndocker run -it --rm busybox\n")])])]),t("h3",{attrs:{id:"node-js"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node-js"}},[e._v("#")]),e._v(" Node.js")]),e._v(" "),t("p",[e._v("从这里基本可以了解到这些镜像只是在Docker Engine上增加了一些依赖,然后你又基于这些依赖搭建你的环境，可以看看"),t("a",{attrs:{href:"https://hub.docker.com/layers/node/library/node/erbium-buster-slim/images/sha256-c6ad96c5345c1a714e0052d08d83635c8e422ea0d103adc7f9f2df4fcfb7fe2d?context=explore",target:"_blank",rel:"noopener noreferrer"}},[e._v("Node Images Layers"),t("OutboundLink")],1),e._v("加深该概念")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# 追加 bash，否则会直接进入node\ndocker run -it --rm node:slim bash\n")])])]),t("h3",{attrs:{id:"nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[e._v("#")]),e._v(" Nginx")]),e._v(" "),t("p",[e._v("快速测试本地打包好的静态文件。")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run --rm \\\n    -p 8080:80 \\\n    -v /dir/dist/:/usr/share/nginx/html \\\n    nginx\n")])])]),t("h3",{attrs:{id:"mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mysql"}},[e._v("#")]),e._v(" MySQL")]),e._v(" "),t("p",[e._v("指定密码")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run --rm \\\n    -p 33006:3306 \\\n    -e MYSQL_ROOT_PASSWORD=mypasswd \\\n  mysql\n")])])]),t("h3",{attrs:{id:"mongo"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mongo"}},[e._v("#")]),e._v(" Mongo")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker run -d \\\n    -p 27017:27017 \\\n    --name some-mongo \\\n    mongo --auth\n")])])]),t("h3",{attrs:{id:"redis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis"}},[e._v("#")]),e._v(" Redis")]),e._v(" "),t("p",[e._v("指定密码")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('docker run -d \\\n    -p 6379:6379 \\\n    --name some-redis \\\n    redis --requirepass "redispwd"\n')])])]),t("h2",{attrs:{id:"docker基本操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker基本操作"}},[e._v("#")]),e._v(" docker基本操作")]),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 启动")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl start docker\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 修改源")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("vim")]),e._v(" /etc/docker/daemon.json\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl daemon-reload\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 重启")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl restart docker\n\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl start docker "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 启动")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl daemon-reload "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 守护进程重启")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl restart docker "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 重启docker 服务")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl stop docker "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 关闭 docker")]),e._v("\n")])])]),t("h2",{attrs:{id:"移除docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#移除docker"}},[e._v("#")]),e._v(" 移除docker")]),e._v(" "),t("p",[e._v("如果在之前修改了存储路径，则根据当前情况进行修改")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("# Ubuntu\nsudo apt-get purge docker-ce docker-ce-cli containerd.io\n# CentOS\nsudo yum remove docker-ce docker-ce-cli containerd.io\n\n# 还有 images、containers、volumes、and configurations\nsudo rm -rf /var/lib/docker\n")])])]),t("h2",{attrs:{id:"docker将容器打包成镜像并传输到其他服务器部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker将容器打包成镜像并传输到其他服务器部署"}},[e._v("#")]),e._v(" docker将容器打包成镜像并传输到其他服务器部署")]),e._v(" "),t("h3",{attrs:{id:"从容器创建一个镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从容器创建一个镜像"}},[e._v("#")]),e._v(" 从容器创建一个镜像")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]\n")])])]),t("p",[e._v("OPTIONS说明:")]),e._v(" "),t("ul",[t("li",[e._v("-a:提交的镜像作者")]),e._v(" "),t("li",[e._v("-c:使用DockerFile指令来创建镜像")]),e._v(" "),t("li",[e._v("-m:提交时的说明文字")]),e._v(" "),t("li",[e._v("-p:在commit时，将容器暂停")])]),e._v(" "),t("p",[e._v("例子🌰")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// 例1\ndocker commit -a 'runoob.com' -m 'my apache' a404c6c174a2  mymysql:v1 \n\n// 例2\ndocker commit -m '' -a '' [CONTAINER ID] [给新的镜像的命名]\n\ndocker commit -m '' -a '' aa myelastcsearch:1.0\n")])])]),t("h3",{attrs:{id:"打包一个镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打包一个镜像"}},[e._v("#")]),e._v(" 打包一个镜像")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker save [OPTIONS] IMAGE [IMAGE...]\n\ndocker save -o my_ubuntu_v3.tar runoob/ubuntu:v3\n")])])]),t("h3",{attrs:{id:"镜像远程拷贝"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像远程拷贝"}},[e._v("#")]),e._v(" 镜像远程拷贝")]),e._v(" "),t("p",[e._v("使用scp传输至其他服务器")]),e._v(" "),t("p",[t("strong",[e._v("从本地复制到远程")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("scp local_file remote_username@remote_ip:remote_folder\n或者 \nscp local_file remote_username@remote_ip:remote_file \n或者 \nscp local_file remote_ip:remote_folder \n或者 \nscp local_file remote_ip:remote_file \n")])])]),t("p",[t("strong",[e._v("从远程复制到本地")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("scp root@www.runoob.com:/home/root/others/music /home/space/music/1.mp3 \nscp -r www.runoob.com:/home/root/others/ /home/space/music/\n")])])]),t("h3",{attrs:{id:"新服务器载入镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新服务器载入镜像"}},[e._v("#")]),e._v(" 新服务器载入镜像")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker load [OPTIONS]\n")])])]),t("p",[e._v("OPTIONS说明")]),e._v(" "),t("ul",[t("li",[e._v("--input,-i:指定导入的文件，代替STDIN")]),e._v(" "),t("li",[e._v("--quiet,-q：精简输出信息")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("docker load --input fedora.tar\n")])])]),t("p",[t("RouterLink",{attrs:{to:"/back-end/Node/#docker概念"}},[e._v("docker构建一个nginx服务器")])],1),e._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[e._v("docker tag node:18-alpine xxx.xxx.xxx.com/base/node:18-alpine\ndocker push xxx.xxx.xxx.com/base/node:18-alpine\n")])])]),t("h2",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[e._v("#")]),e._v(" 参考资料")]),e._v(" "),t("ol",[t("li",[t("a",{attrs:{href:"https://docs.docker.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker"),t("OutboundLink")],1)]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.docker.com/engine/reference/commandline/docker/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker Commands"),t("OutboundLink")],1)]),e._v(" "),t("li",[e._v("《Docker技术入门与实践(第三版)》")]),e._v(" "),t("li",[e._v("《自动动手写Docker》")]),e._v(" "),t("li",[t("a",{attrs:{href:"https://docs.shanyuhai.top/backend/docker/#%E4%BB%8B%E7%BB%8D",target:"_blank",rel:"noopener noreferrer"}},[e._v("当前源文档"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=r.exports}}]);