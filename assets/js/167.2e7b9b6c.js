(window.webpackJsonp=window.webpackJsonp||[]).push([[167],{1109:function(a,t,s){a.exports=s.p+"assets/img/169d80b1620cdac9~tplv-t2oaga2asx-zoom-in-crop-mark_4536_0_0_0.bdb8cc7c.jpg"},1110:function(a,t,s){a.exports=s.p+"assets/img/169d8452cef80241~tplv-t2oaga2asx-zoom-in-crop-mark_4536_0_0_0.11f18712.gif"},1111:function(a,t,s){a.exports=s.p+"assets/img/169d80efd65b5401~tplv-t2oaga2asx-zoom-in-crop-mark_4536_0_0_0.cc1ea6dd.jpg"},2422:function(a,t,s){"use strict";s.r(t);var n=s(46),e=Object(n.a)({},(function(){var a=this,t=a.$createElement,n=a._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h2",{attrs:{id:"broadcast-channel是什么"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#broadcast-channel是什么"}},[a._v("#")]),a._v(" Broadcast Channel是什么？")]),a._v(" "),n("p",[a._v("在前端，我们经常会用到postMessage来实现页面间的通信，但这种方式更像是点对点的通信。对于一些需要广播(让所有页面知道)的消息，用postMessage不是非常自然。Broadcast Channel就是用来弥补这个缺陷的。")]),a._v(" "),n("p",[n("span",{staticStyle:{color:"red"}},[a._v("顾名思义,Broadcast Channel会创建一个所有同源页面都可以共享的(广播)频道，因此其中一个页面发送的消息")])]),a._v(" "),n("h2",{attrs:{id:"如何使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何使用"}},[a._v("#")]),a._v(" 如何使用")]),a._v(" "),n("p",[a._v("Broadcast Channel的API非常简单易用")]),a._v(" "),n("h3",{attrs:{id:"创建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建"}},[a._v("#")]),a._v(" 创建")]),a._v(" "),n("p",[a._v("首先我们会使用构造函数创建一个示例")]),a._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("const")]),a._v(" bc "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("BroadcastChannel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("'alienzhou'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("p",[a._v("可以接受一个DOMString作为name，用以标识这个channel。在其他页面，可以通过传入相同的name来使用同一个广播频道。用MDN上的haul来解释就是")]),a._v(" "),n("blockquote",[n("p",[a._v("There is on single channel with this name for all browsing contexts with the ame origin.")])]),a._v(" "),n("p",[a._v("该name值可以通过实例的.name属性获得")]),a._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[a._v("console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("bc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("h3",{attrs:{id:"监听消息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#监听消息"}},[a._v("#")]),a._v(" 监听消息")]),a._v(" "),n("p",[a._v("Broadcast Channel创建完成后，就可以在页面监听广播的消息")]),a._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[a._v("bc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[a._v("onmessage")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[a._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("'receiver:'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),n("p",[a._v("对于错误也可以绑定监听")]),a._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[a._v("bc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[a._v("onmessageerror")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[a._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("'error:'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),n("blockquote",[n("p",[a._v("除了为.onmessage赋值这种方式，也可以使用addEventListener 来添加'message'监听")])]),a._v(" "),n("h3",{attrs:{id:"发送消息"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#发送消息"}},[a._v("#")]),a._v(" 发送消息")]),a._v(" "),n("p",[a._v("Broadcast Channel实例也有一个对应的postMessage用于发送消息")]),a._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[a._v("bc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("postMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v("'hello'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),n("h3",{attrs:{id:"关闭"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#关闭"}},[a._v("#")]),a._v(" 关闭")]),a._v(" "),n("p",[a._v("可以看到，上述短短几行代码就可以实现多个页面间的广播通信，非常方便。而有时我们希望取消当前页面的广播监听：")]),a._v(" "),n("ul",[n("li",[a._v("一种方式是取消或者修改相应的'message'事件监听")]),a._v(" "),n("li",[a._v("另一种简单的方式就是使用Broadcast Channel实例为我们提供的close方法")])]),a._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[a._v("bc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("close")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),n("p",[a._v("两者是有区别的")]),a._v(" "),n("p",[a._v("取消'message'监听只是让页面不对广播消息进行响应，Broadcast Channel仍然存在;而调用close方法这会切断与Broadcast Channel的连接，浏览器才能够尝试回收该对象，因此此时浏览器才会知道已经不需要使用广播频道了。")]),a._v(" "),n("p",[a._v("在关闭后调用postMessage会出现如下报错")]),a._v(" "),n("p",[n("img",{attrs:{src:s(1109),alt:"报错"}})]),a._v(" "),n("p",[a._v("如果之后又在需要广播，则可以重新创建一个相同name的Broadcast Channel")]),a._v(" "),n("h2",{attrs:{id:"demo"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#demo"}},[a._v("#")]),a._v(" Demo")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://alienzhou.github.io/broadcast-channel/",target:"_blank",rel:"noopener noreferrer"}},[a._v("可以戳这里查看在线 Demo >>"),n("OutboundLink")],1)]),a._v(" "),n("p",[a._v("下面是Broadcast Channel Demo的演示效果\n"),n("img",{attrs:{src:s(1110),alt:"演示效果"}})]),a._v(" "),n("h2",{attrs:{id:"兼容性如何"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#兼容性如何"}},[a._v("#")]),a._v(" 兼容性如何")]),a._v(" "),n("p",[a._v("Broadcast Channel是一个非常好用的多爷们消息同步API，然而兼容性却不是很乐观\n"),n("img",{attrs:{src:s(1111),alt:"兼容性"}})]),a._v(" "),n("p",[a._v("好在我们还有些其他方案可以作为补充（或者作为polyfill），其他的前端跨页面通信可以参考我的另一篇文章"),n("a",{attrs:{href:"https://juejin.cn/post/6844903811232825357",target:"_blank",rel:"noopener noreferrer"}},[a._v("《前端跨页面通信的方法》"),n("OutboundLink")],1),a._v("。")]),a._v(" "),n("h2",{attrs:{id:"资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[a._v("#")]),a._v(" 资料")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://juejin.cn/post/6844903811228663815",target:"_blank",rel:"noopener noreferrer"}},[a._v("前端广播式通信：Broadcast Channel"),n("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);