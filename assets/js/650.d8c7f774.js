(window.webpackJsonp=window.webpackJsonp||[]).push([[650],{2662:function(s,t,a){"use strict";a.r(t);var n=a(46),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"提出问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提出问题"}},[s._v("#")]),s._v(" 提出问题")]),s._v(" "),a("p",[s._v("一个项目中package.json中是这样的")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"serve"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vue-cli-service serve"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vue-cli-service build && rm -fr ./dist/js/*.map"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build:report"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vue-cli-service build  --report"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build:testdev"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vue-cli-service build --mode testdev --dest /opt/ks/containers/nginx/www/dist"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker build ."')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test:unit"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vue-cli-service test:unit"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test:e2e"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vue-cli-service test:e2e"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lint"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"vue-cli-service lint"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prepare"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"husky install"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"precommit"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lint-staged"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])])]),a("p",[s._v("--dest 打包到设置的文件路径(打包之后不包含dist目录)，这样一个引出的 npm scripts的相关问题")]),s._v(" "),a("h2",{attrs:{id:"什么是npm脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是npm脚本"}},[s._v("#")]),s._v(" 什么是npm脚本")]),s._v(" "),a("p",[s._v("npm允许在package.json文件里面，使用scripts字段定义脚本命令")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node build.js"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("上面的代码是package.json文件的一个片段，里面的scripts字段是一个对象。它的每一个属性,对应一段脚本。比如，build命令对应的脚本就是node build.js")]),s._v(" "),a("p",[s._v("命令行下使用npm run命令，就可以执行这段脚本。")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("$ npm run build\n# 等同于\n$ node build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n")])])]),a("p",[s._v("这些定义在package.json里面的脚本，就称为npm脚本。它的优点很多。")]),s._v(" "),a("ul",[a("li",[s._v("项目的相关脚本，可以集中在一个地方。")]),s._v(" "),a("li",[s._v("不同项目的脚本命令,只要功能相同，就可以有同样的对外接口。用户不需要知道怎么测试你的项目，只要运行 npm run test即可")]),s._v(" "),a("li",[s._v("可以利用npm提供的很多辅助功能")])]),s._v(" "),a("p",[a("span",{staticStyle:{color:"green"}},[a("strong",[s._v("查看当前项目的所有npm脚本命令，可以使用不带任何参数的npm run命令")])])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("npm run\n")])])]),a("h2",{attrs:{id:"原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#原理"}},[s._v("#")]),s._v(" 原理")]),s._v(" "),a("p",[a("span",{staticStyle:{color:"red"}},[s._v("npm脚本的原理非常简单，每当执行npm run,就会自动新建一个shell，在这个shell里面执行指定的命令。因此，只要是shell(一般是Bash)可以运行的命令，就可以写在npm脚本里面")])]),s._v(" "),a("p",[a("span",{staticStyle:{color:"red"}},[a("strong",[s._v("比较特别的是，npm run新建的这个shell，会将当前目录的node_module/.bin子目录加入PATH变量，执行结束后，在将PATH变量恢复成原样。")])])]),s._v(" "),a("p",[a("span",{staticStyle:{color:"red"}},[s._v("这意味着，当前目录的node_module/.bin子目录里面的所有脚本，都可以直接用脚本名调用，而不必加上路径")]),s._v("。比如，当前项目的依赖里面有Mocha，只要直接写mocha test就可以了。")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mocha test"')]),s._v("\n")])])]),a("p",[s._v("而不必写成下面这样")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./node_module/.bin/mocha test"')]),s._v("\n")])])]),a("p",[s._v("由于npm脚本的唯一要求就是可以在Shell执行，因此它不一定是Node脚本，任何可以执行文件都可以写在里面")]),s._v(" "),a("p",[s._v("npm脚本的退出码，也遵守Shell脚本规则。如果退出码不是0,npm默认就认为这个脚本执行失败。")]),s._v(" "),a("h2",{attrs:{id:"通配符"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通配符"}},[s._v("#")]),s._v(" 通配符")]),s._v(" "),a("p",[s._v("由于npm脚本就是Shell脚本，因此可以使用Shell脚本")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lint"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jshint *.js"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lint"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jshint **/*.js"')]),s._v("\n")])])]),a("p",[s._v("上面代码中，*表示任意文件名，**表示任意一层子目录。")]),s._v(" "),a("p",[s._v("如果要将通配符传入原始命令，防止被Shell转义，要将星号转义。")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tap test/\\*.js"')]),s._v("\n")])])]),a("h2",{attrs:{id:"传参"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#传参"}},[s._v("#")]),s._v(" 传参")]),s._v(" "),a("p",[a("span",{staticStyle:{color:"red"}},[s._v("向npm脚本传入参数，要使用--标明")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lint"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jshint **.js"')]),s._v("\n")])])]),a("p",[s._v("向上面的npm run lint命令传入参数，必须写成下面这样")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("$ npm run lint "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("reporter checkstyle "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" checkstyle"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xml\n")])])]),a("p",[s._v("也可以在package.json里面在封装一个命令。")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lint"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jshint **.js"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lint:checkstyle"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm run lint -- --reporter checkstyle > checkstyle.xml"')]),s._v("\n")])])]),a("h2",{attrs:{id:"执行顺序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行顺序"}},[s._v("#")]),s._v(" 执行顺序")]),s._v(" "),a("p",[s._v("如果npm脚本里面需要执行多个任务，那么需要明确他们的执行顺序")]),s._v(" "),a("p",[a("span",{staticStyle:{color:"red"}},[s._v("如果是并行执行(即同时的平行执行),可以使用&符号")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("$ npm run script1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" npm run script2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n")])])]),a("p",[a("span",{staticStyle:{color:"red"}},[s._v("如果是继发执行(即只有前一个任务成功，才执行下一个任务)，可以使用&&符号")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("$ npm run script1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" npm run script2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("js\n")])])]),a("p",[s._v("这两个符号是Bash的功能。此外，还可以使用node的任务管理模块："),a("a",{attrs:{href:"https://github.com/paulpflug/script-runner",target:"_blank",rel:"noopener noreferrer"}},[s._v("script-runner"),a("OutboundLink")],1),s._v("、"),a("a",{attrs:{href:"https://github.com/mysticatea/npm-run-all",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm-run-all"),a("OutboundLink")],1),s._v("、"),a("a",{attrs:{href:"https://github.com/coderaiser/redrun",target:"_blank",rel:"noopener noreferrer"}},[s._v("redrun"),a("OutboundLink")],1),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"默认值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#默认值"}},[s._v("#")]),s._v(" 默认值")]),s._v(" "),a("p",[s._v("一般来说,npm脚本由用户提供。但是，npm对两个脚本提供了默认值。也就说，这两个脚本不用定义，就可以直接使用。")]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node server.js"')]),s._v("，\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"install"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-gyp rebuild"')]),s._v("\n")])])]),a("p",[a("span",{staticStyle:{color:"red"}},[s._v("上面代码中，"),a("strong",[s._v("npm run start的默认值是node server.js，前提是项目根目录下有server.js这个脚本；npm run install的默认值是node-gyp rebuild，前提是项目根目录下有binding.gyp文件")]),s._v("。")])]),s._v(" "),a("h2",{attrs:{id:"钩子-hooks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#钩子-hooks"}},[s._v("#")]),s._v(" 钩子---hooks")]),s._v(" "),a("p",[a("span",{staticStyle:{color:"red"}},[s._v("npm 脚本有pre和post两个钩子。举例来说，build脚本命令的钩子就是prebuild和postbuild")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prebuild"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo I run before the build script"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cross-env NODE_ENV=production webpack"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"postbuild"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo I run after the build script"')]),s._v("\n")])])]),a("p",[a("span",{staticStyle:{color:"blue"}},[a("strong",[s._v("用户执行npm run build的时候，会自动按照下面的顺序执行")])])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm run prebuild && npm run build && npm run postbuild\n")])])]),a("p",[s._v("因此,可以在这两个钩子里面，完成一些准备工作和清理工作。下面是一个例子")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('"clean": "rimraf ./dist && mkdir dist",\n"prebuild": "npm run clean",\n"build": "cross-env NODE_ENV=production webpack"\n')])])]),a("p",[a("span",{staticStyle:{color:"red"}},[s._v("npm 默认提供下面这些钩子")])]),s._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("prepublish，postpublish\npreinstall，postinstall\npreuninstall，postuninstall\npreversion，postversion\npretest，posttest\nprestop，poststop\nprestart，poststart\nprerestart，postrestart\n")])])]),a("p",[a("span",{staticStyle:{color:"red"}},[s._v("自定义的脚本命令也可以加上pre和post钩子。比如，myscript这个脚本命令，也有premyscript和postmyscript钩子。不过，双重的pre和post无效，比如prepretest和postposttest是无效的。")])]),s._v(" "),a("p",[a("strong",[a("span",{staticStyle:{color:"orange"}},[s._v("npm提供了一个npm_lifecycle_event变量，返回当前正在运行的脚本名称，比如pretest、test、posttest等等。所以，可以利用这个变量，在同一个脚本文件里面，为不同的npm script命令编写代码。请看下面的例子")])])]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TARGET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("npm_lifecycle_event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TARGET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'test'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Running the test task!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TARGET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'pretest'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  cosnole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Running the pretest task!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("TARGET")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'posttest'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Running the posttest task!'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),a("p",[s._v("注意，prepublish这个钩子不仅会npm publish命令之前运行，还会在npm install(不带任何参数)命令之前运行。这种行为很容易让用户感到困惑，所以npm4引入了一个新的钩子prepare，行为等同于prepublish，而从npm5开始，prepublish将只会在npm publish命令之前运行。")])]),s._v(" "),a("h2",{attrs:{id:"简写形式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简写形式"}},[s._v("#")]),s._v(" 简写形式")]),s._v(" "),a("p",[s._v("四个常用的npm脚本有简写形式")]),s._v(" "),a("ul",[a("li",[s._v("npm start是npm run start")]),s._v(" "),a("li",[s._v("npm stop是npm run stop")]),s._v(" "),a("li",[s._v("npm test 是npm run test")]),s._v(" "),a("li",[s._v("npm restart是npm run stop && npm run restart && npm run start 的简写")])]),s._v(" "),a("p",[s._v("npm start、npm stop和npm restart都比较好理解，而npm restart是一个符合命令，实际上会执行三个脚本命令:stop、restart、start。具体执行顺序如下。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("prerestart\nprestop\nstop\npoststop\nrestart\nprestart\nstart\npoststart\npostrestart\n")])])]),a("h2",{attrs:{id:"变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#变量"}},[s._v("#")]),s._v(" 变量")]),s._v(" "),a("p",[s._v("npm 脚本有一个非常强大的功能，就是可以使用npm的内部变量.")]),s._v(" "),a("p",[s._v("首先，通过npm_package_前缀，npm脚本可以拿到package.json里面的字段。比如下面这个package.json")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"version"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.2.5"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"view"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node view.js"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[a("span",{staticStyle:{color:"red"}},[s._v("那么,变量npm_package_name返回foo，变量npm_package_version返回1.2.5")])]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// view.js")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("npm_package_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// foo")]),s._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("npm_package_version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1.2.5")]),s._v("\n")])])]),a("p",[s._v("上面代码中，我们通过环境变量process.env对象，拿到package.json的字段值。如果是Bash脚本，可以使用$npm_package_name和$npm_package_version取到这两个值。")]),s._v(" "),a("p",[a("span",{staticStyle:{color:"red"}},[s._v("npm_package_前缀也支持嵌套的package.json字段")])]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('"repository": {\n  "type": "git",\n  "url": "xxx"\n},\nscripts: {\n  "view": "echo $npm_package_repository_type"\n}\n')])])]),a("p",[a("span",{staticStyle:{color:"red"}},[s._v("上面代码中，repository字段的type属性，可以通过npm_package_repository_type收到")])]),s._v(" "),a("p",[s._v("下面是另外一个例子")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('"scripts": {\n  "install": "foo.js"\n}\n')])])]),a("p",[s._v("上面代码中，nppm_package_scripts_install变量的值等于foo.js")]),s._v(" "),a("p",[s._v("然后，npm脚本还可以通过npm_config_前缀，拿到npm的配置变量，即npm config get xxx命令返回的值。比如，当前模块的发行标签，可以通过npm_config_tag取到")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('"view": "echo $npm_config_tag",\n')])])]),a("p",[s._v("注意，package.json里面的config对象，可以被环境变量覆盖。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('{ \n  "name" : "foo",\n  "config" : { "port" : "8080" },\n  "scripts" : { "start" : "node server.js" }\n}\n')])])]),a("p",[s._v("上面代码中，npm_package_config_port变量返回的是8080。这个值可以用下面的方法覆盖。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm config set foo:port 80\n")])])]),a("p",[s._v("最后，env命令可以列出所有环境变量。")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('"env":"env"\n')])])]),a("h2",{attrs:{id:"常用脚本示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用脚本示例"}},[s._v("#")]),s._v(" 常用脚本示例")]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 删除目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clean"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rimraf dist/*"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 本地搭建一个 HTTP 服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"serve"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http-server -p 9090 dist/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 打开浏览器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"open:dev"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"opener http://localhost:9090"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 实时刷新")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"livereload"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"live-reload --port 9091 dist/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 构建 HTML 文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build:html"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jade index.jade > dist/index.html"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 只要 CSS 文件有变动，就重新执行构建")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch:css"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"watch 'npm run build:css' assets/styles/\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 只要 HTML 文件有变动，就重新执行构建")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch:html"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"watch 'npm run build:html' assets/html\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 部署到 Amazon S3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deploy:prod"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s3-cli sync ./dist/ s3://example-com/prod-site/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 构建 favicon")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build:favicon"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node scripts/favicon.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])])]),a("h2",{attrs:{id:"npm-run-的其他问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#npm-run-的其他问题"}},[s._v("#")]),s._v(" npm run 的其他问题")]),s._v(" "),a("ol",[a("li",[a("span",{staticStyle:{color:"red"}},[s._v("查看项目中依赖的包的所有版本 npm ls webpack")])])]),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("➜  zhiliao git"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pc_feat_space_setting"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" npm ls webpack\nzhiliao@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Users"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xuzhe"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Desktop"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ks"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("zhiliao\n├─┬ @vue"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cli"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("babel@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.5")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".15")]),s._v("\n│ └── webpack@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.46")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\n├─┬ @vue"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cli"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("eslint@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.5")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".15")]),s._v("\n│ └── webpack@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.46")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("  deduped\n├─┬ @vue"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cli"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("plugin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("typescript@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.5")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".15")]),s._v("\n│ └── webpack@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.46")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("  deduped\n└─┬ @vue"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cli"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("service@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.5")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".15")]),s._v("\n  └── webpack@"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.46")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("  deduped\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("npm install 报错")])]),s._v(" "),a("p",[s._v("解决：执行npm install gifsicle@4.0.1 --ignore-scripts")]),s._v(" "),a("p",[a("span",{staticStyle:{color:"red"}},[s._v("使用--ignore-scripts,则会让npm避免执行package.json文件中的scripts脚本。而只进行打包")])]),s._v(" "),a("h2",{attrs:{id:"资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资料"}},[s._v("#")]),s._v(" 资料")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2016/10/npm_scripts.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("npm scripts使用指南"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("RouterLink",{attrs:{to:"/source-vue/base-evn.html"}},[s._v("vue变量")])],1),s._v(" "),a("div",{staticClass:"language-javascript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[s._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("VUE_APP_TEST")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("npm_lifecycle_event\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// vue项目中就可以使用process.env.VUE_APP_TEST")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);