(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{1705:function(s,t,a){s.exports=a.p+"assets/img/7d976bd2e374477f81ebdb7a16f350f3_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.3fa18352.png"},1706:function(s,t,a){s.exports=a.p+"assets/img/fef1b95f763f4845ba35161030c7e7c3_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.6b69da1c.png"},1707:function(s,t,a){s.exports=a.p+"assets/img/6dc983815fa14963bc39232521d8682c_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.97c59159.png"},1708:function(s,t,a){s.exports=a.p+"assets/img/aa1e550ed76f47cba6d31efb5cee2d24_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.eef02b41.png"},1709:function(s,t,a){s.exports=a.p+"assets/img/88ae0fb3f0034d1ea92283287516fd5d_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.1c8b9763.png"},1710:function(s,t,a){s.exports=a.p+"assets/img/b343c857f6c74b48bafec805c4316457_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.98c5e5e8.png"},1711:function(s,t,a){s.exports=a.p+"assets/img/7e9849521e5b48e2bf31f1a1f1d567d8_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.57496b33.png"},1712:function(s,t,a){s.exports=a.p+"assets/img/ba4296df30314854a5732f8907dafa5c_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.6b0f191a.png"},1713:function(s,t,a){s.exports=a.p+"assets/img/d125cd89dd364ebdb85733e1e1b12793_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.8ba27018.png"},1714:function(s,t,a){s.exports=a.p+"assets/img/e721e551b019453d9027e7cd4a229bb6_tplv-k3u1fbpfcp-zoom-in-crop-mark_4536_0_0_0.b77ae90f.png"},2736:function(s,t,a){"use strict";a.r(t);var n=a(46),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[s._v("#")]),s._v(" 目录")]),s._v(" "),n("div",{staticClass:"language-md extra-class"},[n("pre",{pre:!0,attrs:{class:"language-md"}},[n("code",[n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 打包阶段\n    "),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 第一步:安装speed-measure-webpack-plugin\n    "),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 第二步:安装cache-loader\n    "),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 第三步:安装happypack\n    "),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 第四步:安装webpack-parallel-uglify-plugin\n    "),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 打包总结\n"),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 上线优化阶段\n    "),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 第一步:基础优化\n    "),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 第二步:路由懒加载和按需引入\n    "),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 第三步:优化代码和合并相同的包\n    "),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 第四步:在服务器上的优化\n    "),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 上线优化总结\n"),n("span",{pre:!0,attrs:{class:"token list punctuation"}},[s._v("-")]),s._v(" 最后优化总结\n")])])]),n("h2",{attrs:{id:"打包阶段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#打包阶段"}},[s._v("#")]),s._v(" 打包阶段")]),s._v(" "),n("p",[s._v("这是一个基于webpack@3.6.0的项目,所以在安装功能包的时候要注意起版本，所以下面安装包我都贴心的把对应的版本加上了")]),s._v(" "),n("h3",{attrs:{id:"第一步-安装speed-measure-webpack-plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第一步-安装speed-measure-webpack-plugin"}},[s._v("#")]),s._v(" 第一步:安装speed-measure-webpack-plugin")]),s._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('安装包版本: "speed-measure-webpack-pulgin":"^1.5.0"\n')])])]),n("p",[n("span",{staticStyle:{color:"red"}},[s._v("该安装包的作用:"),n("strong",[s._v("在打包的过程中,能够精确的帮你分析出每一个步骤耗费的时间，然后我们可以针对时间比较长的部分专门做优化")])])]),s._v(" "),n("p",[s._v("一下是配置")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" SpeedMeasurePlugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'speed-measure-webpack-plugin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" smp "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SpeedMeasurePlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" webpackConfig "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" smp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wrap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("merge")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("baseWebpack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),n("p",[s._v("执行npm run build之后，我们可以看到结果\n"),n("img",{attrs:{src:a(1705),alt:"speed-measure-webpack-pulgin"}})]),s._v(" "),n("h3",{attrs:{id:"第二步-安装cache-loader"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第二步-安装cache-loader"}},[s._v("#")]),s._v(" 第二步:安装cache-loader")]),s._v(" "),n("div",{staticClass:"language-md extra-class"},[n("pre",{pre:!0,attrs:{class:"language-md"}},[n("code",[s._v('安装包版本:"cache-loader": "^4.1.0"\n')])])]),n("p",[n("span",{staticStyle:{color:"red"}},[s._v("对sass-loader、postcss-loader、vue-loader做打包缓存，缩短打包的时间")])]),s._v(" "),n("p",[s._v("以下是对vue-loader和url-loader做缓存的代码")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" cacheLoader "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    loader"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'cache-loader'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nrules"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        test"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.vue$")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        use"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            cacheLoader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                loader"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vue-loader'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                options"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" vueLoaderConfig\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        test"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.(png|jpe?g|gif|svg)(\\?.*)?$")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        use"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            cacheLoader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                loader"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'url-loader'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                options"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    limit"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                    name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" utils"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("assetsPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'img/[name].[hash:7].[ext]'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),n("p",[s._v("以下是对cssLoader、postcssLoader做缓存的代码")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" loaders "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("usePostCSS "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("cacheLoader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" cssLoader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" postcssLoader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("cacheLoader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" cssLoader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),n("p",[s._v("执行npm run build之后，我们可以看到如下结果\n"),n("img",{attrs:{src:a(1706),alt:"cache-loader"}})]),s._v(" "),n("p",[s._v("对比之后的成果:plugin打包时间缩短了0.8秒钟，loader时间缩短了2.94秒,打包一共缩短了2.7秒钟。")]),s._v(" "),n("p",[s._v("由于这个项目包比较小，缩短的时间并不是特别明显")]),s._v(" "),n("h3",{attrs:{id:"第三步-安装happpypack-当前项目太小-没有起到效果-当时后端管理项目有优化效果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第三步-安装happpypack-当前项目太小-没有起到效果-当时后端管理项目有优化效果"}},[s._v("#")]),s._v(" 第三步:安装happpypack(当前项目太小，没有起到效果，当时后端管理项目有优化效果)")]),s._v(" "),n("div",{staticClass:"language-md extra-class"},[n("pre",{pre:!0,attrs:{class:"language-md"}},[n("code",[s._v('安装包版本:"happypack":"^5.0.1"\n')])])]),n("p",[s._v("可以在打包的时候开启多线程打包。"),n("a",{attrs:{href:"https://www.npmjs.com/package/happypack",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用连接"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("因为上面主要是sass-loader包最占用时间，并且已经开启了缓存，时间上优化到很小的一个水平。当然，我重新开启了happypack进行多线程打包，可能由于项目太小，发现时间不仅没有变短，还多了0.2秒。划不来了。就不画蛇添足了")]),s._v(" "),n("p",[s._v("稍大一些的项目可以开启这个多线程打包模式，根据具体的项目而定。")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1707),alt:"happypack"}})]),s._v(" "),n("h3",{attrs:{id:"第四步-安装webpack-parallel-uglify-plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第四步-安装webpack-parallel-uglify-plugin"}},[s._v("#")]),s._v(" 第四步:安装webpack-parallel-uglify-plugin")]),s._v(" "),n("div",{staticClass:"language-md extra-class"},[n("pre",{pre:!0,attrs:{class:"language-md"}},[n("code",[s._v('安装包版本:"webpack-parallel-uglify-plugin":"1.1.0"\n')])])]),n("p",[s._v("用上图中可以看到UglifyJsPlugin这个包打包时间过长，我想到可以使用webpack-parallel-uglify-plugin这个包，开启多核同步压缩增加压缩的效率")]),s._v(" "),n("p",[s._v("开始配置")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" ParallelUglifyPlugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack-parallel-uglify-plugin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ParalleUglifyPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    uglifyJS"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        output"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            beautify"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否保留空格和制表符，设置不保留")]),s._v("\n            comments"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否保留代码中的注释，设置不保留")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        compress"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            drop_console"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否删除代码中的console语句，设置为删除")]),s._v("\n            collapse_vars"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否内嵌虽然已经定义了，但是只用到一次的变量，设置不适用")]),s._v("\n            reduce_var"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否提取出现了多次但是没有定义成变量去引用的静态值，设置不转换")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        warnings"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否在删除没有用到的代码时输出警告信息，设置为不警告")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),n("p",[s._v("将UglifyJsPlugin之前设置的地方用ParalleUglifyPlugin的配置覆盖，在执行npm run build，对比前后的打包速度")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1708),alt:"uglifyJsPlugin"}})]),s._v(" "),n("p",[s._v("打包速度减少了0.9秒，plugin的压缩速度好像没有变化(可能是我的电脑性能不太好，去年那个管理端的项目优化是能看到几秒的优化效果的)")]),s._v(" "),n("h3",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),n("p",[s._v("从这个小项目触发来看，整个打包过程从9.95秒减少到了6.25秒，打包效率提高了35%。去年我做的后台项目的打包效率提升大概是43%左右，总体来说差距不是很大。")]),s._v(" "),n("h2",{attrs:{id:"上线优化阶段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#上线优化阶段"}},[s._v("#")]),s._v(" 上线优化阶段")]),s._v(" "),n("p",[s._v("首先安装一个打包分析工具，用来查看生成包的大小")]),s._v(" "),n("h3",{attrs:{id:"安装webpack-bundle-analyzer"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装webpack-bundle-analyzer"}},[s._v("#")]),s._v(" 安装webpack-bundle-analyzer")]),s._v(" "),n("ul",[n("li",[s._v("打开分析有2中方式\n"),n("ul",[n("li",[n("span",{staticStyle:{color:"blue"}},[s._v("方式1:在plugins中默认配置new BundleAnalyzerPlugin()，然后执行npm run dev的时候，会弹出一个页面，然后再页面中查看每个包的大小")])]),s._v(" "),n("li",[n("span",{staticStyle:{color:"blue"}},[s._v("方式2:在plugins中进行配置，会生成一个stats.json方法，执行webpack --profile --json > stats.json命令生成分析文件，执行webpack-bundle-analyzer --port 8888 ./dist/stats.json展示各个包的体积页面。")])])])])]),s._v(" "),n("p",[s._v("方式1在做开发的时候会觉得奇怪，每次启动开发的时候都会自动打开分析文件，一脸的黑脸问好，所以选择更加人性化，在想要分析的时候直接分析并生成页面即可")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// webpack.config.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" BundleAnalyzerPlugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'webpack-bundle-analyzer'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BundleAnalyzerPlugin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nplugins"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("BundleAnalyzerPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        analyzerMode"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'disabled'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 不启动展示打包报告的http服务器")]),s._v("\n        generateStatsFile"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 是否生成stats.json")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// package.json")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"generateAnalyzFile"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webpack --config build/webpack.dev.conf.js --profile --json > stats.json"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 生成分析文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"analyz"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"webpack-bundle-analyzer --port 8888 ./stats.json"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 启动展示打包报告的http服务器")]),s._v("\n")])])]),n("p",[n("img",{attrs:{src:a(1709),alt:"webpack-analyzer"}})]),s._v(" "),n("p",[s._v("查看每个包的占用情况")]),s._v(" "),n("p",[s._v("下面开始做优化")]),s._v(" "),n("h3",{attrs:{id:"第一步-基础优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第一步-基础优化"}},[s._v("#")]),s._v(" 第一步:基础优化")]),s._v(" "),n("p",[s._v("根据雅虎35条军规的规则，先看自己的项目有没有要优化的。")]),s._v(" "),n("ol",[n("li",[s._v("尽量减少HTTP请求数")]),s._v(" "),n("li",[s._v("减少DNS查找")]),s._v(" "),n("li",[s._v("避免重定向")]),s._v(" "),n("li",[s._v("让Ajax可缓存")])]),s._v(" "),n("ul",[n("li",[s._v("...")])]),s._v(" "),n("ol",{attrs:{start:"35"}},[n("li",[s._v("添上Expires或Cache-Control HTTP头")])]),s._v(" "),n("h3",{attrs:{id:"第二步-路由懒加载和按需引入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第二步-路由懒加载和按需引入"}},[s._v("#")]),s._v(" 第二步:路由懒加载和按需引入")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("路由懒加载")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    name"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TopicList'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    component"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@/components/TopicList'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])])]),s._v(" "),n("li",[n("p",[s._v("组件的按需引入")]),s._v(" "),n("p",[s._v("因为使用的公用组件比较少,采用按需引入的方式，而不是将整个包放到cdn中")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    Header"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    Button\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mint-ui'")]),s._v("\nVue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Header"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nVue"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Button"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])])])]),s._v(" "),n("p",[s._v("优化效果\n"),n("img",{attrs:{src:a(1710),alt:"优化效果"}})]),s._v(" "),n("p",[s._v("优化效果：减少了0.17MB，效果不是很明显")]),s._v(" "),n("h3",{attrs:{id:"第三步-优化代码和合并相同的包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第三步-优化代码和合并相同的包"}},[s._v("#")]),s._v(" 第三步:优化代码和合并相同的包")]),s._v(" "),n("p",[s._v("此时的包展示情况是这样的\n"),n("img",{attrs:{src:a(1711),alt:"analyz"}})]),s._v(" "),n("ol",[n("li",[n("p",[s._v("对这些包进行分析并优化")]),s._v(" "),n("p",[s._v("首先看到这里的0.js,1.js和2.js中的moment.js都有用到，能不能只对他们做一个合并。而且moment.js占用的包太大了，能不能只对其中使用到的部分进行打包。")]),s._v(" "),n("p",[s._v("首先是对moment.js只引用中文包的优化，配置如下：")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//解决moment打包的时候把所有的语言都打包进去的问题")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("webpack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ContextReplacementPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("moment[\\\\\\/]locale$")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token regex"}},[n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("^\\.\\/(zh-cn)$")]),n("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),n("p",[s._v("同时有一些组价引用了这个组件，但是没有使用，这种情况也会打包进去，所以无用的代码也要删除")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 这部分引入了，但是没使用，要删除")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" moment "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'moment'")]),s._v("\n")])])]),n("p",[s._v("删除无用的代码之后成了这样。\n"),n("img",{attrs:{src:a(1712),alt:"删除无用的代码"}}),s._v("\n只有1.js和3.js对整个包有做引用(这是异步加载的组件)。")]),s._v(" "),n("p",[s._v("此时整个项目包的大小在1.34Mb")])]),s._v(" "),n("li",[n("p",[s._v("然后是对moment.js包配置，让其只打包一次")]),s._v(" "),n("p",[s._v("将moment.js项目单独提取出来,通过全局引入的方式，就不会在每个项目中都重复引入了。可以进入如下配置")]),s._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// main.js")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" moment "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'moment'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("prototype"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$moment "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" moment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// TopicList.vue")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" date1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("$moment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("date"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("formNow")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),n("p",[s._v("此时优化后的结果如下：\n"),n("img",{attrs:{src:a(1713),alt:"优化之后"}})])])]),s._v(" "),n("p",[s._v("我想了一下，整个moment.js在组件间的引入方式是异步引入的，首屏加载的时候不会引入其他文件的moment.js。这个步骤可以根据大家的实际加载速度来处理。")]),s._v(" "),n("p",[s._v("后续如果加入到app.js中的公共包太多了，可以把公共部分的包提取出来，将其传入到cdn加速服务中，减小app.js的包大小")]),s._v(" "),n("p",[s._v("此时包的大小在1.17MB")]),s._v(" "),n("h3",{attrs:{id:"第四步-在服务器上的优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第四步-在服务器上的优化"}},[s._v("#")]),s._v(" 第四步:在服务器上的优化")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("图片和其他文件进行无损压缩，并上传到CDN上")]),s._v(" "),n("p",[s._v("图片通过tinyjpg.com 该网站进行无损压缩之后，上传到腾讯云对象存储中。 css和js等代码文件进行压缩，然后再上传熬cdn上。")])]),s._v(" "),n("li",[n("p",[s._v("Nginx配置开通gzip，从线上拉取的代码能压缩2/3")]),s._v(" "),n("p",[n("img",{attrs:{src:a(1714),alt:""}})])])]),s._v(" "),n("p",[s._v("上线之后，最终的包大小在123.3KB")]),s._v(" "),n("h3",{attrs:{id:"上线优化总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#上线优化总结"}},[s._v("#")]),s._v(" 上线优化总结")]),s._v(" "),n("p",[s._v("从分析工具上来看：最初包的体积是3.14MB，减少到1.17MB，一共优化了1.97MB的体积，优化效率在62.7%")]),s._v(" "),n("p",[s._v("通过上面的4步操作之后，整个包最终体积是123.KB，打开速度很快，挺好的。")]),s._v(" "),n("h2",{attrs:{id:"总结-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结-2"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),n("p",[s._v("经过上面的操作，我们可以看到。")]),s._v(" "),n("ul",[n("li",[s._v("在打包阶段，打包时间整个打包过程从9.95秒，减少到6.52秒，打包优化效率提高了35%。")]),s._v(" "),n("li",[s._v("在上线前的优化阶段，从最初的体积是3.14MB，减少到1.17MB，优化效率在62.7%，挺不错的结果。")])]),s._v(" "),n("p",[n("a",{attrs:{href:"https://juejin.cn/post/7136453274948861983",target:"_blank",rel:"noopener noreferrer"}},[s._v("如何通过性能优化，将包的体积压缩了62.7%"),n("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);